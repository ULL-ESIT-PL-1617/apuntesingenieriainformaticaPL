<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">

<!--Converted with LaTeX2HTML 2008 (1.71)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>Patrones Recursivos</TITLE>
<META NAME="description" CONTENT="Patrones Recursivos">
<META NAME="keywords" CONTENT="perlexamples">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META NAME="Generator" CONTENT="LaTeX2HTML v2008">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="mystyle.css">

<LINK REL="next" HREF="node62.html">
<LINK REL="previous" HREF="node60.html">
<LINK REL="up" HREF="node56.html">
<LINK REL="next" HREF="node62.html">
</HEAD>

<BODY >

<A NAME="tex2html2061"
  HREF="node62.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html2055"
  HREF="node56.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html2049"
  HREF="node60.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html2057"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A> 
<A NAME="tex2html2059"
  HREF="node322.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A> <A NAME="tex2html2"
  HREF="http://nereida.deioc.ull.es/~pl/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="PL.jpg"
 ALT="PL"></A><A NAME="tex2html3"
  HREF="http://campusvirtual.ull.es/0910/course/view.php?id=1148"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="hatpl.png"
 ALT="PL moodle"></A><A NAME="tex2html4"
  HREF="pl.ps"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="gv.jpeg"
 ALT="ps"></A><A NAME="tex2html5"
  HREF="perl_errata_form.html"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="icon_errata.jpg"
 ALT="errata"></A><A NAME="tex2html6"
  HREF="http://search.cpan.org/"><IMG
  WIDTH="60" ALIGN="BOTTOM" BORDER="0"
 SRC="lupa.gif"
 ALT="modulos"></A><A NAME="tex2html7"
  HREF="http://www.perlmonks.org/?node=Seekers of Perl Wisdom"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="monk.gif"
 ALT="perlmonks"></A><A NAME="tex2html8"
  HREF="http://perldoc.perl.org/"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="perlonion.jpeg"
 ALT="perldoc"></A><A NAME="tex2html9"
  HREF="http://nereida.deioc.ull.es/~lhp/perlexamples/"><IMG
  WIDTH="22" ALIGN="BOTTOM" BORDER="0"
 SRC="logoLHP.jpg"
 ALT="apuntes LHP"></A><A NAME="tex2html10"
  HREF="http://www.google.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ggoogle.gif"
 ALT="google"></A><A NAME="tex2html11"
  HREF="http://www.etsii.ull.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="etsii.png"
 ALT="etsii"></A><A NAME="tex2html12"
  HREF="http://www.ull.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ull.gif"
 ALT="ull"></A><A NAME="tex2html13"
  HREF="http://nereida.deioc.ull.es/"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="pcgull"></A>
<BR>
<B> Sig:</B> <A NAME="tex2html2062"
  HREF="node62.html">Cuantificadores Posesivos</A>
<B>Sup:</B> <A NAME="tex2html2056"
  HREF="node56.html">Algunas Extensiones</A>
<B> Ant:</B> <A NAME="tex2html2050"
  HREF="node60.html">Definición de Nombres de</A>
 <B>Err:</B> <a href="perl_errata_form.html" target="_blank">Si hallas una errata ...</a>
<BR> <P>

<!--End of Navigation Panel-->
<!--Table of Child-Links-->
<A NAME="CHILD_LINKS"><STRONG>Subsecciones</STRONG></A>

<UL>
<LI><UL>
<LI><A NAME="tex2html2063"
  HREF="node61.html#SECTION00825010000000000000">Palíndromos</A>
<LI><A NAME="tex2html2064"
  HREF="node61.html#SECTION00825020000000000000">Lo que dice <TT>perlre</TT> sobre recursividad</A>
<LI><A NAME="tex2html2065"
  HREF="node61.html#SECTION00825030000000000000">Paréntesis Equilibrados</A>
<LI><A NAME="tex2html2066"
  HREF="node61.html#SECTION00825040000000000000">Capturando los bloques de un programa</A>
<LI><A NAME="tex2html2067"
  HREF="node61.html#SECTION00825050000000000000">Reconocimiento de Lenguajes Recursivos: Un subconjunto de L<SUP><SMALL>A</SMALL></SUP>T<SMALL>E</SMALL>X</A>
<LI><A NAME="tex2html2068"
  HREF="node61.html#SECTION00825060000000000000">Reconocimiento de Expresiones Aritméticas</A>
</UL></UL>
<!--End of Table of Child-Links-->
<HR>

<H2><A NAME="SECTION00825000000000000000">
Patrones Recursivos</A>
</H2>

<P>
Perl 5.10 introduce la posibilidad de definir 
subpatrones en una sección del patrón. 
Citando la versión del documento <A NAME="tex2html81"
  HREF="http://search.cpan.org/perldoc/?perlretut"><TT>perlretut</TT></A>
para
perl5.10:

<P>
<BLOCKQUOTE><I>This feature (introduced in Perl 5.10) significantly extends the power
of Perl’s pattern matching.  By referring to some other capture group
anywhere in the
pattern with the construct <code>(?group-ref)</code>, the pattern within the
referenced group is used as an independent subpattern in place of the
group reference itself.
Because the group reference may be contained within the group it refers
to, it is now possible to apply pattern matching to tasks that hitherto
required a
recursive parser.
</I></BLOCKQUOTE>
<P>
<BLOCKQUOTE><I>...
</I></BLOCKQUOTE>
<P>
<BLOCKQUOTE><I>In <code>(?...)</code> both absolute and relative backreferences may be used.  
The entire pattern can be reinserted with <code>(?R)</code> or <code>(?0)</code>.  If you prefer to name your
buffers, you can use <code>(?&amp;name)</code> to recurse into that buffer.
</I></BLOCKQUOTE>

<P>

<H4><A NAME="SECTION00825010000000000000">
Palíndromos</A>
</H4>
  

<A NAME="parrafo:palabrapalindromos"></A>
<P>
Véase un ejemplo que reconoce los palabra-palíndromos (esto es, 
la lectura directa y la inversa  de la cadena
pueden diferir en los signos de puntuación):

<P>

<pre>
casiano<span class="synIdentifier">@millo</span>:~<span class="synStatement">/</span><span class="synConstant">Lperltesting$ cat -n palindromos</span><span class="synSpecial">.</span><span class="synConstant">pl</span>
<span class="synConstant">     1  #!</span><span class="synStatement">/</span>usr/<span class="synStatement">local</span>/lib/perl/<span class="synConstant">5.10</span>.<span class="synConstant">1</span>/bin//perl5.<span class="synConstant">10.1</span> <span class="synStatement">-w</span>
     <span class="synConstant">2</span>  <span class="synStatement">use </span>v5.<span class="synConstant">10</span>;
     <span class="synConstant">3</span>
     <span class="synConstant">4</span>  <span class="synStatement">my</span> <span class="synIdentifier">$regexp</span> = <span class="synConstant">qr/^</span><span class="synSpecial">(\W*</span>
<span class="synConstant">     5                       </span><span class="synSpecial">(?:</span>
<span class="synConstant">     6                             </span><span class="synSpecial">(\w)</span><span class="synConstant"> </span><span class="synSpecial">(?</span><span class="synConstant">1</span><span class="synSpecial">)</span><span class="synConstant"> </span><span class="synSpecial">\g</span><span class="synConstant">{-1}  # palindromo estricto</span>
<span class="synConstant">     7                           |</span>
<span class="synConstant">     8                             </span><span class="synSpecial">\w?</span><span class="synConstant">               # no recursiva</span>
<span class="synConstant">     9                       </span><span class="synSpecial">)</span>
<span class="synConstant">    10                    </span><span class="synSpecial">\W*)</span><span class="synConstant">$/ix</span>;
    <span class="synConstant">11</span>
    <span class="synConstant">12</span>  <span class="synStatement">my</span> <span class="synIdentifier">$input</span> = &lt;&gt;;
    <span class="synConstant">13</span>  <span class="synStatement">chomp</span>(<span class="synIdentifier">$input</span>);
    <span class="synConstant">14</span>  <span class="synStatement">if</span> (<span class="synIdentifier">$input</span> =~ <span class="synIdentifier">$regexp</span>) {
    <span class="synConstant">15</span>    say <span class="synConstant">"</span><span class="synIdentifier">$input</span><span class="synConstant"> is a palindrome"</span>;
    <span class="synConstant">16</span>  }
    <span class="synConstant">17</span>  <span class="synStatement">else</span> {
    <span class="synConstant">18</span>    say <span class="synConstant">"does not match"</span>;
    <span class="synConstant">19</span>  }
</pre>

<P>
<P>
<DIV><B>Ejercicio  3.2.3</B> &nbsp; 
<I>¿Cuál es el efecto del modificador <code>i</code>
en la regexp <code>qr/^(\W* (?: (\w) (?1) \g{-1} | \w? ) \W*)$/ix</code>?</I></DIV><P></P>

<P>
Siguen algunos ejemplos de ejecución<A NAME="tex2html82"
  HREF="footnode.html#foot2764"><SUP>3.5</SUP></A>
<pre>
pl@nereida:~/Lperltesting$ <span class="dbuser">./palindromos.pl</span>
<span class="dbuser">A man, a plan, a canal: Panama!</span>
A man, a plan, a canal: Panama! is a palindrome
pl@nereida:~/Lperltesting$ <span class="dbuser">./palindromos.pl</span>
<span class="dbuser">A man, a plan, a cam, a yak, a yam, a canal – Panama!</span>
A man, a plan, a cam, a yak, a yam, a canal – Panama! is a palindrome
pl@nereida:~/Lperltesting$ <span class="dbuser">./palindromos.pl</span>
<span class="dbuser">A man, a plan, a cat, a ham, a yak, a yam, a hat, a canal – Panama!</span>
A man, a plan, a cat, a ham, a yak, a yam, a hat, a canal – Panama! is a palindrome
pl@nereida:~/Lperltesting$ <span class="dbuser">./palindromos.pl</span>
<span class="dbuser">saippuakauppias</span>
saippuakauppias is a palindrome
pl@nereida:~/Lperltesting$ <span class="dbuser">./palindromos.pl</span>
<span class="dbuser">dfghjgfd</span>
does not match
<span class="dbuser">pl@nereida:~/Lperltesting$ ./palindromos.pl</span>
<span class="dbuser">...,;;;;</span>
...,;;;; is a palindrome
</pre>

<P>

<H4><A NAME="SECTION00825020000000000000">
Lo que dice <TT>perlre</TT> sobre recursividad</A>
</H4>
  

<P>
<BLOCKQUOTE><I><code>(?PARNO) (?-PARNO) (?+PARNO) (?R) (?0)</code>
</I></BLOCKQUOTE>
<P>
<BLOCKQUOTE><I>Similar to <code>(??{ code })</code> (véase la sección
<A HREF="node65.html#subsection:tiempodematching">3.2.9</A>)
except it does not involve compiling any code,
instead it treats the contents of a capture buffer as an independent
pattern that must match at the current position. Capture buffers
contained by the pattern will have the value as determined by the
outermost recursion.
</I></BLOCKQUOTE>
<P>
<BLOCKQUOTE><I><code>PARNO</code> is a sequence of digits (not starting with 0) whose value
reflects the paren-number of the capture buffer to recurse to. 
</I></BLOCKQUOTE>
<P>
<BLOCKQUOTE><I><code>(?R)</code>
recurses to the beginning of the whole pattern. <code>(?0)</code> is an alternate
syntax for <code>(?R)</code>. 
</I></BLOCKQUOTE>
<P>
<BLOCKQUOTE><I>If <code>PARNO</code> is preceded by a plus or minus sign then it
is assumed to be relative, with negative numbers indicating preceding
capture buffers and positive ones following. Thus (?-1) refers to the
most recently declared buffer, and (?+1) indicates the next buffer to
be declared. 
</I></BLOCKQUOTE>
<P>
<BLOCKQUOTE><I>Note that the counting for relative recursion differs from
that of relative backreferences, in that with recursion unclosed buffers
are included.
</I></BLOCKQUOTE>
Hay una diferencia fundamental entre <code>\g{-1}</code> y <code>(?-1)</code>.
El primero significa <I>lo que casó con el último paréntesis</I>.
El segundo significa que se debe <I>llamar a la expresión regular 
que define el último paréntesis</I>. Véase un ejemplo:
<PRE>
pl@nereida:~/Lperltesting$ perl5.10.1 -wdE 0
main::(-e:1):   0
  DB&lt;1&gt;  x ($a = "12 aAbB 34") =~ s/([aA])(?-1)(?+1)([bB])/-\1\2-/g
0  1
  DB&lt;2&gt; p $a
12 -aB- 34
</PRE>

<P>
En <A NAME="tex2html83"
  HREF="http://search.cpan.org/perldoc/?perlre"><TT>perlre</TT></A>
también se comenta sobre este punto:
<BLOCKQUOTE><I>If there is no corresponding capture buffer defined, then it is a fatal
error. Recursing deeper than 50 times without consuming any input string
will also result in a fatal error. The maximum depth is compiled into
perl, so changing it requires a custom build.
</I></BLOCKQUOTE>

<P>

<H4><A NAME="SECTION00825030000000000000">
Paréntesis Equilibrados</A>
</H4>
  

<P>
El siguiente programa (inspirado en uno
que aparece en <A NAME="tex2html84"
  HREF="http://search.cpan.org/perldoc/?perlre"><TT>perlre</TT></A>)
reconoce una llamada a una función <code>foo()</code>
que puede contener una secuencia de expresiones con paréntesis equilibrados
como argumento:

<P>

<pre>
<span class="synLinenum">    1</span> pl<span class="synIdentifier">@nereida</span>:~<span class="synStatement">/</span><span class="synConstant">Lperltesting$ cat perlrebalancedpar</span><span class="synSpecial">.</span><span class="synConstant">pl</span>
<span class="synLinenum">    2</span> <span class="synConstant">#!</span><span class="synStatement">/</span>usr/<span class="synStatement">local</span>/lib/perl/<span class="synConstant">5.10</span>.<span class="synConstant">1</span>/bin//perl5.<span class="synConstant">10.1</span>  <span class="synStatement">-w</span>
<span class="synLinenum">    3</span> <span class="synStatement">use </span>v5.<span class="synConstant">10</span>;
<span class="synLinenum">    4</span> <span class="synStatement">use strict</span>;
<span class="synLinenum">    5</span> 
<span class="synLinenum">    6</span> <span class="synStatement">my</span> <span class="synIdentifier">$regexp</span> = <span class="synConstant">qr{ </span><span class="synSpecial">(</span><span class="synConstant">                      # paren group 1 </span><span class="synSpecial">(</span><span class="synConstant">full function</span><span class="synSpecial">)</span>
<span class="synLinenum">    7</span> <span class="synConstant">                foo</span>
<span class="synLinenum">    8</span> <span class="synConstant">                   </span><span class="synSpecial">(</span><span class="synConstant">                    # paren group 2 </span><span class="synSpecial">(</span><span class="synConstant">parens</span><span class="synSpecial">)</span>
<span class="synLinenum">    9</span> <span class="synConstant">                     </span><span class="synSpecial">\(</span>
<span class="synLinenum">   10</span> <span class="synConstant">                        </span><span class="synSpecial">(</span><span class="synConstant">               # paren group 3 </span><span class="synSpecial">(</span><span class="synConstant">contents of parens</span><span class="synSpecial">)</span>
<span class="synLinenum">   11</span> <span class="synConstant">                           </span><span class="synSpecial">(?:</span>
<span class="synLinenum">   12</span> <span class="synConstant">                                </span><span class="synSpecial">[^()]+</span><span class="synConstant">  # Non-parens</span>
<span class="synLinenum">   13</span> <span class="synConstant">                              |</span>
<span class="synLinenum">   14</span> <span class="synConstant">                                </span><span class="synSpecial">(?</span><span class="synConstant">2</span><span class="synSpecial">)</span><span class="synConstant"> # Recurse to start of paren group 2</span>
<span class="synLinenum">   15</span> <span class="synConstant">                           </span><span class="synSpecial">)*</span>
<span class="synLinenum">   16</span> <span class="synConstant">                        </span><span class="synSpecial">)</span><span class="synConstant">               # 3</span>
<span class="synLinenum">   17</span> <span class="synConstant">                     </span><span class="synSpecial">\)</span>
<span class="synLinenum">   18</span> <span class="synConstant">                    </span><span class="synSpecial">)</span><span class="synConstant">                   # 2</span>
<span class="synLinenum">   19</span> <span class="synConstant">              </span><span class="synSpecial">)</span><span class="synConstant">                         # 1</span>
<span class="synLinenum">   20</span> <span class="synConstant">    }x</span>;
<span class="synLinenum">   21</span> 
<span class="synLinenum">   22</span> <span class="synStatement">my</span> <span class="synIdentifier">$input</span> = &lt;&gt;;
<span class="synLinenum">   23</span> <span class="synStatement">chomp</span>(<span class="synIdentifier">$input</span>);
<span class="synLinenum">   24</span> <span class="synStatement">my</span> <span class="synIdentifier">@res</span> = (<span class="synIdentifier">$input</span> =~<span class="synStatement"> /</span><span class="synIdentifier">$regexp</span><span class="synStatement">/</span>);
<span class="synLinenum">   25</span> <span class="synStatement">if</span> (<span class="synIdentifier">@res</span>) {
<span class="synLinenum">   26</span>   say <span class="synConstant">"&lt;</span><span class="synIdentifier">$&amp;</span><span class="synConstant">&gt; is balanced</span><span class="synSpecial">\n</span><span class="synConstant">Paren: (</span><span class="synIdentifier">@res</span><span class="synConstant">)"</span>;
<span class="synLinenum">   27</span> }
<span class="synLinenum">   28</span> <span class="synStatement">else</span> {
<span class="synLinenum">   29</span>   say <span class="synConstant">"does not match"</span>;
<span class="synLinenum">   30</span> }
</pre>
Al ejecutar obtenemos:

<P>

<pre>
pl@nereida:~/Lperltesting$  <span class="dbuser">./perlrebalancedpar.pl</span>
<span class="dbuser">foo(bar(baz)+baz(bop))</span>
&lt;foo(bar(baz)+baz(bop))&gt; is balanced
Paren: (foo(bar(baz)+baz(bop)) (bar(baz)+baz(bop)) bar(baz)+baz(bop))
</pre>

<P>
Como se comenta en <A NAME="tex2html85"
  HREF="http://search.cpan.org/perldoc/?perlre"><TT>perlre</TT></A>
es conveniente usar 
índices relativos si se quiere tener una expresión regular reciclable:

<P>
<BLOCKQUOTE><I>The following shows how using negative indexing can make it easier to
embed recursive patterns inside of a <code>qr//</code> construct for later use:
</I></BLOCKQUOTE>
<P><PRE>
   1. my $parens = qr/(\((?:[^()]++|(?-1))*+\))/;
   2. if (/foo $parens \s+ + \s+ bar $parens/x) {
   3.   # do something here...
   4. }
</PRE>
Véase la sección 
<A HREF="node62.html#subsection:cuantificadoresposesivos">3.2.6</A>
para comprender el uso de los operadores posesivos como <code>++</code>.

<P>

<H4><A NAME="SECTION00825040000000000000">
Capturando los bloques de un programa</A>
</H4>
  

<A NAME="parrafo:bloquesanidados"></A>
<P>
El siguiente programa presenta una heurística 
para determinar los bloques de un programa:

<P>

<pre>
<span class="synLinenum">    1</span>   pl<span class="synIdentifier">@nereida</span>:~<span class="synStatement">/</span><span class="synConstant">Lperltesting$ cat blocks</span><span class="synSpecial">.</span><span class="synConstant">pl</span>
<span class="synLinenum">    2</span> <span class="synConstant">  #!</span><span class="synStatement">/</span>usr/<span class="synStatement">local</span>/lib/perl/<span class="synConstant">5.10</span>.<span class="synConstant">1</span>/bin//perl5.<span class="synConstant">10.1</span> <span class="synStatement">-w</span>
<span class="synLinenum">    3</span>   <span class="synStatement">use </span>v5.<span class="synConstant">10</span>;
<span class="synLinenum">    4</span>   <span class="synStatement">use strict</span>;
<span class="synLinenum">    5</span>   <span class="synComment">#use re 'debug';</span>
<span class="synLinenum">    6</span>   
<span class="synLinenum">    7</span>   <span class="synStatement">my</span> <span class="synIdentifier">$rb</span> = <span class="synConstant">qr{</span><span class="synSpecial">(?x)</span>
<span class="synLinenum">    8</span> <span class="synConstant">      </span><span class="synSpecial">(</span>
<span class="synLinenum">    9</span> <span class="synConstant">        </span><span class="synSpecial">&#92;{</span><span class="synConstant">               # llave abrir</span>
<span class="synLinenum">   10</span> <span class="synConstant">           </span><span class="synSpecial">(?:</span>
<span class="synLinenum">   11</span> <span class="synConstant">               </span><span class="synSpecial">[^{}]++</span><span class="synConstant">   # no llaves</span>
<span class="synLinenum">   12</span> <span class="synConstant">           |</span>
<span class="synLinenum">   13</span> <span class="synConstant">                </span><span class="synSpecial">[^{}]*+</span><span class="synConstant">  # no llaves</span>
<span class="synLinenum">   14</span> <span class="synConstant">                </span><span class="synSpecial">(?</span><span class="synConstant">1</span><span class="synSpecial">)</span><span class="synConstant">     # recursivo</span>
<span class="synLinenum">   15</span> <span class="synConstant">                </span><span class="synSpecial">[^{}]*+</span><span class="synConstant">  # no llaves</span>
<span class="synLinenum">   16</span> <span class="synConstant">           </span><span class="synSpecial">)*+</span>
<span class="synLinenum">   17</span> <span class="synConstant">         </span><span class="synSpecial">&#92;}</span><span class="synConstant">              # llave cerrar</span>
<span class="synLinenum">   18</span> <span class="synConstant">      </span><span class="synSpecial">)</span>
<span class="synLinenum">   19</span> <span class="synConstant">    }</span>;
<span class="synLinenum">   20</span>   
<span class="synLinenum">   21</span>   <span class="synStatement">local</span> <span class="synIdentifier">$/</span> = <span class="synStatement">undef</span>;
<span class="synLinenum">   22</span>   <span class="synStatement">my</span> <span class="synIdentifier">$input</span> = &lt;&gt;;
<span class="synLinenum">   23</span>   <span class="synStatement">my</span><span class="synIdentifier">@blocks</span> = <span class="synIdentifier">$input</span> =~ <span class="synStatement">m{</span><span class="synIdentifier">$rb</span><span class="synStatement">}g</span>;
<span class="synLinenum">   24</span>   <span class="synStatement">my</span> <span class="synIdentifier">$i</span> = <span class="synConstant">0</span>;
<span class="synLinenum">   25</span>   say(<span class="synIdentifier">$i</span>++.<span class="synConstant">":</span><span class="synSpecial">\n</span><span class="synIdentifier">$_</span><span class="synSpecial">\n</span><span class="synConstant">==="</span>) <span class="synStatement">for</span> <span class="synIdentifier">@blocks</span>;
</pre>

<P>
Veamos una ejecución. Le daremos como entrada el siguiente programa:
Al ejecutar el programa con esta entrada obtenemos:

<P>
<TABLE CELLPADDING=3 BORDER="1">
<TR><TD ALIGN="LEFT" VALIGN="TOP" WIDTH=227><PRE>
pl@nereida:~/Lperltesting$ cat -n blocks.c
     1  main() { /* 1 */
     2    { /* 2 */ }
     3    { /* 3 */ }
     4  }
     5
     6  f(){  /* 4 */
     7    {   /* 5 */
     8      { /* 6 */ }
     9    }
    10    {   /* 7 */
    11      { /* 8 */ }
    12    }
    13  }
    14
    15  g(){ /* 9 */
    16  }
    17
    18  h() {
    19  {{{}}}
    20  }
    21  /* end h */
</PRE></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=227><PRE>
pl@nereida:~/Lperltesting$ perl5.10.1 blocks.pl blocks.c
0:
{ /* 1 */
  { /* 2 */ }
  { /* 3 */ }
}
===
1:
{  /* 4 */
  {   /* 5 */
    { /* 6 */ }
  }
  {   /* 7 */
    { /* 8 */ }
  }
}
===
2:
{ /* 9 */
}
===
3:
{
{{{}}}
}
===
</PRE></TD>
</TR>
</TABLE>

<P>

<H4><A NAME="SECTION00825050000000000000">
Reconocimiento de Lenguajes Recursivos: Un subconjunto de L<SUP><SMALL>A</SMALL></SUP>T<SMALL>E</SMALL>X</A>
</H4>
  

<A NAME="subsection:regexp510lenrec"></A>
<P>
La posibilidad de combinar en las expresiones regulares Perl 5.10 
la recursividad con los constructos <code>(?&lt;name&gt;...)</code> 
y <code>?&amp;name)</code> así como las secciones <code>(?(DEFINE) ...)</code>
permiten la escritura de expresiones regulares que reconocen lenguajes recursivos. 
El siguiente 
ejemplo muestra un reconocedor de un subconjunto del lenguaje 
L<SUP><SMALL>A</SMALL></SUP>T<SMALL>E</SMALL>X (véase <A NAME="tex2html87"
  HREF="http://en.wikipedia.org/wiki/LaTeX">la entrada LaTeX en la wikipedia</A>):

<P>

<pre>
<span class="synLinenum">    1</span> pl<span class="synIdentifier">@nereida</span>:~<span class="synStatement">/</span><span class="synConstant">Lperltesting$ cat latex5_10</span><span class="synSpecial">.</span><span class="synConstant">pl</span>
<span class="synLinenum">    2</span> <span class="synConstant">#!</span><span class="synStatement">/</span>usr/<span class="synStatement">local</span>/lib/perl/<span class="synConstant">5.10</span>.<span class="synConstant">1</span>/bin//perl5.<span class="synConstant">10.1</span> <span class="synStatement">-w</span>
<span class="synLinenum">    3</span> <span class="synStatement">use strict</span>;
<span class="synLinenum">    4</span> <span class="synStatement">use </span>v5.<span class="synConstant">10</span>;
<span class="synLinenum">    5</span> 
<span class="synLinenum">    6</span> <span class="synStatement">my</span> <span class="synIdentifier">$regexp</span> = <span class="synConstant">qr{</span>
<span class="synLinenum">    7</span> <span class="synConstant">    </span><span class="synSpecial">\A(?</span><span class="synConstant">&amp;File</span><span class="synSpecial">)\z</span>
<span class="synLinenum">    8</span> 
<span class="synLinenum">    9</span> <span class="synConstant">    </span><span class="synSpecial">(?(</span><span class="synConstant">DEFINE</span><span class="synSpecial">)</span>
<span class="synLinenum">   10</span> <span class="synConstant">        </span><span class="synSpecial">(?</span><span class="synConstant">&lt;File&gt;     </span><span class="synSpecial">(?</span><span class="synConstant">&amp;Element</span><span class="synSpecial">)*+\s*</span>
<span class="synLinenum">   11</span> <span class="synConstant">        </span><span class="synSpecial">)</span>
<span class="synLinenum">   12</span> 
<span class="synLinenum">   13</span> <span class="synConstant">        </span><span class="synSpecial">(?</span><span class="synConstant">&lt;Element&gt;  </span><span class="synSpecial">\s*</span><span class="synConstant"> </span><span class="synSpecial">(?</span><span class="synConstant">&amp;Command</span><span class="synSpecial">)</span>
<span class="synLinenum">   14</span> <span class="synConstant">                  |  </span><span class="synSpecial">\s*</span><span class="synConstant"> </span><span class="synSpecial">(?</span><span class="synConstant">&amp;Literal</span><span class="synSpecial">)</span>
<span class="synLinenum">   15</span> <span class="synConstant">        </span><span class="synSpecial">)</span>
<span class="synLinenum">   16</span> 
<span class="synLinenum">   17</span> <span class="synConstant">        </span><span class="synSpecial">(?</span><span class="synConstant">&lt;Command&gt;  </span><span class="synSpecial">\\</span><span class="synConstant"> </span><span class="synSpecial">\s*</span><span class="synConstant"> </span><span class="synSpecial">(?</span><span class="synConstant">&lt;L&gt;</span><span class="synSpecial">(?</span><span class="synConstant">&amp;Literal</span><span class="synSpecial">))</span><span class="synConstant"> </span><span class="synSpecial">\s*</span><span class="synConstant"> </span><span class="synSpecial">(?</span><span class="synConstant">&lt;Op&gt;</span><span class="synSpecial">(?</span><span class="synConstant">&amp;Options</span><span class="synSpecial">)?)</span><span class="synConstant"> </span><span class="synSpecial">\s*</span><span class="synConstant"> </span><span class="synSpecial">(?</span><span class="synConstant">&lt;A&gt;</span><span class="synSpecial">(?</span><span class="synConstant">&amp;Args</span><span class="synSpecial">))</span>
<span class="synLinenum">   18</span> <span class="synConstant">           </span><span class="synSpecial">(?</span><span class="synConstant">{</span>
<span class="synLinenum">   19</span> <span class="synConstant">              say "command: &lt;</span><span class="synIdentifier">$+</span><span class="synConstant">{L}</span>&gt; options: &lt;<span class="synIdentifier">$+</span>{Op}&gt; args: &lt;<span class="synIdentifier">$+</span>{A}&gt;<span class="synConstant">"</span>
<span class="synLinenum">   20</span> <span class="synConstant">           })</span>
<span class="synLinenum">   21</span> <span class="synConstant">        )</span>
<span class="synLinenum">   22</span> 
<span class="synLinenum">   23</span> <span class="synConstant">        (?&lt;Options&gt;  </span><span class="synSpecial">\[</span><span class="synConstant"> </span><span class="synSpecial">\s</span><span class="synConstant">* (?:(?&amp;Option) (?:</span><span class="synSpecial">\s</span><span class="synConstant">*,</span><span class="synSpecial">\s</span><span class="synConstant">* (?&amp;Option) )*)? </span><span class="synSpecial">\s</span><span class="synConstant">* </span><span class="synSpecial">\]</span>
<span class="synLinenum">   24</span> <span class="synConstant">        )</span>
<span class="synLinenum">   25</span> 
<span class="synLinenum">   26</span> <span class="synConstant">        (?&lt;Args&gt;     (?: </span><span class="synSpecial">&#92;{</span><span class="synConstant"> </span><span class="synSpecial">\s</span><span class="synConstant">* (?&amp;Element)* </span><span class="synSpecial">\s</span><span class="synConstant">* </span><span class="synSpecial">&#92;}</span><span class="synConstant"> )*</span>
<span class="synLinenum">   27</span> <span class="synConstant">        )</span>
<span class="synLinenum">   28</span> 
<span class="synLinenum">   29</span> <span class="synConstant">        (?&lt;Option&gt;   </span><span class="synSpecial">\s</span><span class="synConstant">* [^][</span><span class="synSpecial">$</span><span class="synConstant">&amp;%#_{}~^</span><span class="synSpecial">\s</span><span class="synConstant">,]+</span>
<span class="synLinenum">   30</span> <span class="synConstant">        )</span>
<span class="synLinenum">   31</span> 
<span class="synLinenum">   32</span> <span class="synConstant">        (?&lt;Literal&gt;  </span><span class="synSpecial">\s</span><span class="synConstant">* ([^][</span><span class="synSpecial">$</span><span class="synConstant">&amp;%#_{}~^</span><span class="synSpecial">\s</span><span class="synConstant">]+)</span>
<span class="synLinenum">   33</span> <span class="synConstant">        )</span>
<span class="synLinenum">   34</span> <span class="synConstant">    )</span>
<span class="synLinenum">   35</span> <span class="synConstant">}xms;</span>
<span class="synLinenum">   36</span> 
<span class="synLinenum">   37</span> <span class="synConstant">my </span><span class="synIdentifier">$input</span><span class="synConstant"> = do{ local </span><span class="synIdentifier">$/</span><span class="synConstant">; &lt;&gt;};</span>
<span class="synLinenum">   38</span> <span class="synConstant">if (</span><span class="synIdentifier">$input</span><span class="synConstant"> =~ </span><span class="synIdentifier">$regexp</span><span class="synConstant">) {</span>
<span class="synLinenum">   39</span> <span class="synConstant">  say "</span><span class="synIdentifier">$@</span>: matches:\n<span class="synIdentifier">$&amp;</span><span class="synConstant">";</span>
<span class="synLinenum">   40</span> <span class="synConstant">}</span>
<span class="synLinenum">   41</span> <span class="synConstant">else {</span>
<span class="synLinenum">   42</span> <span class="synConstant">  say "</span>does <span class="synStatement">not</span> match<span class="synConstant">";</span>
<span class="synLinenum">   43</span> <span class="synConstant">}</span>
</pre>

<P>
Añadimos una acción semántica al final de la aceptación de un <code>&lt;Command&gt;</code>.

<P>
<PRE>
         (?&lt;Command&gt;  \\ \s* (?&lt;L&gt;(?&amp;Literal)) \s* (?&lt;Op&gt;(?&amp;Options)?) \s* (?&lt;A&gt;(?&amp;Args)?)
            (?{
               say "command: &lt;$+{L}&gt; options: &lt;$+{Op}&gt; args: &lt;$+{A}&gt;"
            })
         )
</PRE>
Esta acción es ejecutada pero no afecta al proceso de análisis.
(véase la sección
<A HREF="node64.html#subsection:codigoenregexp">3.2.8</A> para mas información sobre las acciones semánticas
en medio de una regexp).
La acción se limita a mostrar que ha casado con cada una de las tres componentes:
el comando, las opciones y los argumentos.

<P>
Los paréntesis adicionales, como en <code>(?&lt;L&gt;(?&amp;Literal))</code> son necesarios 
para guardar lo que casó.

<P>
Cuando se ejecuta produce la siguiente salida<A NAME="tex2html86"
  HREF="footnode.html#foot2768"><SUP>3.6</SUP></A>: <PRE>
pl@nereida:~/Lperltesting$ cat prueba.tex
\documentclass[a4paper,11pt]{article}
\usepackage{latexsym}
\author{D. Conway}
\title{Parsing \LaTeX{}}
\begin{document}
\maketitle
\tableofcontents
\section{Description}
...is easy \footnote{But not\\ \emph{necessarily} simple}.
In fact it's easy peasy to do.
\end{document}

pl@nereida:~/Lperltesting$ ./latex5_10.pl prueba.tex
command: &lt;documentclass&gt; options: &lt;[a4paper,11pt]&gt; args: &lt;{article}&gt;
command: &lt;usepackage&gt; options: &lt;&gt; args: &lt;{latexsym}&gt;
command: &lt;author&gt; options: &lt;&gt; args: &lt;{D. Conway}&gt;
command: &lt;LaTeX&gt; options: &lt;&gt; args: &lt;{}&gt;
command: &lt;title&gt; options: &lt;&gt; args: &lt;{Parsing \LaTeX{}}&gt;
command: &lt;begin&gt; options: &lt;&gt; args: &lt;{document}&gt;
command: &lt;maketitle&gt; options: &lt;&gt; args: &lt;&gt;
command: &lt;tableofcontents&gt; options: &lt;&gt; args: &lt;&gt;
command: &lt;section&gt; options: &lt;&gt; args: &lt;{Description}&gt;
command: &lt;emph&gt; options: &lt;&gt; args: &lt;{necessarily}&gt;
command: &lt;footnote&gt; options: &lt;&gt; args: &lt;{But not\\ \emph{necessarily} simple}&gt;
command: &lt;end&gt; options: &lt;&gt; args: &lt;{document}&gt;
: matches:
\documentclass[a4paper,11pt]{article}
\usepackage{latexsym}
\author{D. Conway}
\title{Parsing \LaTeX{}}
\begin{document}
\maketitle
\tableofcontents
\section{Description}
...is easy \footnote{But not\\ \emph{necessarily} simple}.
In fact it's easy peasy to do.
\end{document}
</PRE>
La siguiente entrada <code>prueba3.tex</code> no pertenece
al lenguaje definido por el patrón regular,
debido a la presencia de la cadena <code>$In$</code>
en la última línea:
<PRE>
pl@nereida:~/Lperltesting$ cat prueba3.tex
\documentclass[a4paper,11pt]{article}
\usepackage{latexsym}
\author{D. Conway}
\title{Parsing \LaTeX{}}
\begin{document}
\maketitle
\tableofcontents
\section{Description}
\comm{a}{b}
...is easy \footnote{But not\\ \emph{necessarily} simple}.
$In$ fact it's easy peasy to do.
\end{document}

pl@nereida:~/Lperltesting$ ./latex5_10.pl prueba3.tex
command: &lt;documentclass&gt; options: &lt;[a4paper,11pt]&gt; args: &lt;{article}&gt;
command: &lt;usepackage&gt; options: &lt;&gt; args: &lt;{latexsym}&gt;
command: &lt;author&gt; options: &lt;&gt; args: &lt;{D. Conway}&gt;
command: &lt;LaTeX&gt; options: &lt;&gt; args: &lt;{}&gt;
command: &lt;title&gt; options: &lt;&gt; args: &lt;{Parsing \LaTeX{}}&gt;
command: &lt;begin&gt; options: &lt;&gt; args: &lt;{document}&gt;
command: &lt;maketitle&gt; options: &lt;&gt; args: &lt;&gt;
command: &lt;tableofcontents&gt; options: &lt;&gt; args: &lt;&gt;
command: &lt;section&gt; options: &lt;&gt; args: &lt;{Description}&gt;
command: &lt;comm&gt; options: &lt;&gt; args: &lt;{a}{b}&gt;
command: &lt;emph&gt; options: &lt;&gt; args: &lt;{necessarily}&gt;
command: &lt;footnote&gt; options: &lt;&gt; args: &lt;{But not\\ \emph{necessarily} simple}&gt;
does not match
</PRE>

<P>
<P>
<DIV><B>Ejercicio  3.2.4</B> &nbsp; 
<I>Obsérvese el uso del cuantificador posesivo en:
</I><PRE>
 10          (?&lt;File&gt;     (?&amp;Element)*+\s*
 11          )
</PRE><I>
¿Que ocurrre si se quita el posesivo 
y se vuelve a ejecutar <code>$ ./latex5_10.pl prueba3.tex</code>?</I></DIV><P></P>

<P>

<H4><A NAME="SECTION00825060000000000000">
Reconocimiento de Expresiones Aritméticas</A>
</H4>
  

<P>
Véase el nodo <A NAME="tex2html88"
  HREF="http://www.perlmonks.org/?node_id=585167">Complex regex for maths formulas</A>
en perlmonks
para la formulación del problema. Un monje pregunta:

<P>
<BLOCKQUOTE><I>Hiya monks,
</I></BLOCKQUOTE>
<P>
<BLOCKQUOTE><I>Im having trouble getting my head around a regular expression to match sequences.
I need to catch all exceptions where a mathematical expression is illegal...
</I></BLOCKQUOTE>
<P>
<BLOCKQUOTE><I>There must be either a letter or a digit either side of an operator
parenthesis must open and close next to letters or digits, not next to operators, and do not have to exist
variables must not be more than one letter
Nothing other than <code>a-z,A-Z,0-9,+,-,*,/,(,)</code> can be used
</I></BLOCKQUOTE>
<P>
<BLOCKQUOTE><I>Can anyone offer a hand on how best to tackle this problem?
</I></BLOCKQUOTE>
<P>
<BLOCKQUOTE><I>many thanks 
</I></BLOCKQUOTE> 

<P>
La solución parte de que una <I>expresión</I> es o bien un <I>término</I> o bien 
un <I>término</I> seguido de una operador y un <I>término</I>, esto es:

<P>

<UL>
<LI><code>termino</code>
</LI>
<LI><code>termino op termino op termino</code> ...
</LI>
</UL>
que puede ser unificado como <code>termino (op termino)*</code>.

<P>
Un <I>término</I> es un número o un identificador o una <I>expresión</I>
entre paréntesis, esto es:

<P>

<UL>
<LI><code>numero</code>
</LI>
<LI><code>identificador</code>
</LI>
<LI><code> ( expresión ) </code>
</LI>
</UL>

<P>
La siguiente expresión regular recursiva sigue esta idea:

<pre>
pl@nereida:~/Lperltesting$ cat -n simpleexpressionsna.pl
<span class="synLinenum">    1</span>   <span class="synComment">#!/usr/local/lib/perl/5.10.1/bin//perl5.10.1</span>
<span class="synLinenum">    2</span>   <span class="synStatement">use </span>v5.<span class="synConstant">10</span>;
<span class="synLinenum">    3</span>   <span class="synStatement">use strict</span>;
<span class="synLinenum">    4</span>   <span class="synStatement">use warnings</span>;
<span class="synLinenum">    5</span> 
<span class="synLinenum">    6</span>   <span class="synStatement">local</span> <span class="synStatement">our</span> (<span class="synIdentifier">$skip</span>, <span class="synIdentifier">$term</span>, <span class="synIdentifier">$expr</span>);
<span class="synLinenum">    7</span>   <span class="synIdentifier">$skip</span> = <span class="synConstant">qr/</span><span class="synSpecial">\s*</span><span class="synConstant">/</span>;
<span class="synLinenum">    8</span>   <span class="synIdentifier">$expr</span> = <span class="synConstant">qr{ </span><span class="synSpecial">(?</span><span class="synConstant">&lt;EXPR&gt;</span>
<span class="synLinenum">    9</span> <span class="synConstant">                     </span><span class="synSpecial">(?</span><span class="synConstant">&lt;TERM&gt;              # An expression is a TERM  </span><span class="synSpecial">...</span>
<span class="synLinenum">   10</span> <span class="synConstant">                            </span><span class="synIdentifier">$skip</span><span class="synConstant"> </span><span class="synSpecial">(?</span><span class="synConstant">&lt;ID&gt;</span><span class="synSpecial">[a-zA-Z]+)</span>
<span class="synLinenum">   11</span> <span class="synConstant">                          | </span><span class="synIdentifier">$skip</span><span class="synConstant"> </span><span class="synSpecial">(?</span><span class="synConstant">&lt;INT&gt;</span><span class="synSpecial">[1-9]\d*)</span>
<span class="synLinenum">   12</span> <span class="synConstant">                          | </span><span class="synIdentifier">$skip</span><span class="synConstant"> </span><span class="synSpecial">\(</span>
<span class="synLinenum">   13</span> <span class="synConstant">                            </span><span class="synIdentifier">$skip</span><span class="synConstant">  </span><span class="synSpecial">(?</span><span class="synConstant">&amp;EXPR</span><span class="synSpecial">)</span>
<span class="synLinenum">   14</span> <span class="synConstant">                            </span><span class="synIdentifier">$skip</span><span class="synConstant"> </span><span class="synSpecial">\)</span>
<span class="synLinenum">   15</span> <span class="synConstant">                     </span><span class="synSpecial">)</span><span class="synConstant"> </span><span class="synSpecial">(?:</span><span class="synConstant"> </span><span class="synIdentifier">$skip</span><span class="synConstant">           # possibly followed by a sequence of </span><span class="synSpecial">...</span>
<span class="synLinenum">   16</span> <span class="synConstant">                           </span><span class="synSpecial">(?</span><span class="synConstant">&lt;OP&gt;</span><span class="synSpecial">[-+*/])</span>
<span class="synLinenum">   17</span> <span class="synConstant">                           </span><span class="synSpecial">(?</span><span class="synConstant">&amp;TERM</span><span class="synSpecial">)</span><span class="synConstant">        # </span><span class="synSpecial">...</span><span class="synConstant"> operand TERM pairs</span>
<span class="synLinenum">   18</span> <span class="synConstant">                       </span><span class="synSpecial">)*</span>
<span class="synLinenum">   19</span> <span class="synConstant">              </span><span class="synSpecial">)</span>
<span class="synLinenum">   20</span> <span class="synConstant">            }x</span>;
<span class="synLinenum">   21</span>   <span class="synStatement">my</span> <span class="synIdentifier">$re</span> = <span class="synConstant">qr/^ </span><span class="synIdentifier">$expr</span><span class="synConstant"> </span><span class="synIdentifier">$skip</span><span class="synConstant"> </span><span class="synSpecial">\z</span><span class="synConstant">/x</span>;
<span class="synLinenum">   22</span> <span class="synIdentifier">  </span><span class="synStatement">sub</span><span class="synIdentifier"> is_valid </span>{ <span class="synStatement">shift</span> =~<span class="synStatement"> /</span><span class="synIdentifier">$re</span><span class="synStatement">/o</span> }
<span class="synLinenum">   23</span> 
<span class="synLinenum">   24</span>   <span class="synStatement">my</span> <span class="synIdentifier">@test</span> = ( <span class="synConstant">'(a + 3)'</span>, <span class="synConstant">'(3 * 4)+(b + x)'</span>, <span class="synConstant">'(5 - a)*z'</span>,
<span class="synLinenum">   25</span>                 <span class="synConstant">'((5 - a))*((((z)))+2)'</span>, <span class="synConstant">'3 + 2'</span>, <span class="synConstant">'!3 + 2'</span>, <span class="synConstant">'3 + 2!'</span>,
<span class="synLinenum">   26</span>                 <span class="synConstant">'3 a'</span>, <span class="synConstant">'3 3'</span>, <span class="synConstant">'3 * * 3'</span>,
<span class="synLinenum">   27</span>                 <span class="synConstant">'2 - 3 * 4'</span>,  <span class="synConstant">'2 - 3 + 4'</span>,
<span class="synLinenum">   28</span>               );
<span class="synLinenum">   29</span>   <span class="synStatement">foreach</span> (<span class="synIdentifier">@test</span>) {
<span class="synLinenum">   30</span>     say(<span class="synConstant">"</span><span class="synIdentifier">$_</span><span class="synConstant">:"</span>);
<span class="synLinenum">   31</span>     say(is_valid(<span class="synIdentifier">$_</span>) ? <span class="synConstant">"</span><span class="synSpecial">\n</span><span class="synConstant">&lt;</span><span class="synIdentifier">$_</span><span class="synConstant">&gt; is valid"</span> : <span class="synConstant">"</span><span class="synSpecial">\n</span><span class="synConstant">&lt;</span><span class="synIdentifier">$_</span><span class="synConstant">&gt; is not valid"</span>)
<span class="synLinenum">   32</span>   }
</pre>
Podemos usar acciones semánticas empotradas para 
ver la forma en la que trabaja la expresión regular
(véase la sección
<A HREF="node64.html#subsection:codigoenregexp">3.2.8</A>):

<P>

<pre>
pl@nereida:~/Lperltesting$ cat -n simpleexpressions.pl
<span class="synLinenum">    1</span>   <span class="synComment">#!/usr/local/lib/perl/5.10.1/bin//perl5.10.1</span>
<span class="synLinenum">    2</span>   <span class="synStatement">use </span>v5.<span class="synConstant">10</span>;
<span class="synLinenum">    3</span>   <span class="synStatement">use strict</span>;
<span class="synLinenum">    4</span>   <span class="synStatement">use warnings</span>;
<span class="synLinenum">    5</span> 
<span class="synLinenum">    6</span>   <span class="synStatement">use </span>re <span class="synConstant">'eval'</span>; <span class="synComment"># to allow Eval-group at runtime</span>
<span class="synLinenum">    7</span> 
<span class="synLinenum">    8</span>   <span class="synStatement">local</span> <span class="synStatement">our</span> (<span class="synIdentifier">$skip</span>, <span class="synIdentifier">$term</span>, <span class="synIdentifier">$expr</span>);
<span class="synLinenum">    9</span>   <span class="synIdentifier">$skip</span> = <span class="synConstant">qr/</span><span class="synSpecial">\s*</span><span class="synConstant">/</span>;
<span class="synLinenum">   10</span>   <span class="synIdentifier">$expr</span> = <span class="synConstant">qr{ </span><span class="synSpecial">(?</span><span class="synConstant">&lt;EXPR&gt;</span>
<span class="synLinenum">   11</span> <span class="synConstant">                     </span><span class="synSpecial">(?</span><span class="synConstant">&lt;TERM&gt;              # An expression is a TERM  </span><span class="synSpecial">...</span>
<span class="synLinenum">   12</span> <span class="synConstant">                            </span><span class="synIdentifier">$skip</span><span class="synConstant"> </span><span class="synSpecial">(?</span><span class="synConstant">&lt;ID&gt;</span><span class="synSpecial">[a-zA-Z]+)</span><span class="synConstant">  </span><span class="synSpecial">(?</span><span class="synConstant">{ print "</span><span class="synSpecial">[ID $+{ID}]</span><span class="synConstant"> "  }</span>)
<span class="synLinenum">   13</span>                           | <span class="synIdentifier">$skip</span> (?<span class="synIdentifier">&lt;INT&gt;</span>[<span class="synConstant">1-9</span>]\d*)  (?{ <span class="synStatement">print</span> <span class="synConstant">"[INT </span><span class="synIdentifier">$+</span><span class="synConstant">{INT}] "</span> })
<span class="synLinenum">   14</span>                           | <span class="synIdentifier">$skip</span> \(                (?{ <span class="synStatement">print</span> <span class="synConstant">"[(] "</span> })
<span class="synLinenum">   15</span>                             <span class="synIdentifier">$skip</span>  (?<span class="synIdentifier">&amp;EXPR</span>)
<span class="synLinenum">   16</span>                             <span class="synIdentifier">$skip</span> \)                (?{ <span class="synStatement">print</span> <span class="synConstant">"[)] "</span> })
<span class="synLinenum">   17</span>                      ) (?: <span class="synIdentifier">$skip</span>           <span class="synComment"># possibly followed by a sequence of ...</span>
<span class="synLinenum">   18</span>                            (?<span class="synIdentifier">&lt;OP&gt;</span>[-+*/])            (?{ <span class="synStatement">print</span> <span class="synConstant">"[OP </span><span class="synIdentifier">$+</span><span class="synConstant">{OP}] "</span> })
<span class="synLinenum">   19</span>                            (?<span class="synIdentifier">&amp;TERM</span>)        <span class="synComment"># ... operand TERM pairs</span>
<span class="synLinenum">   20</span>                        )*
<span class="synLinenum">   21</span>               )
<span class="synLinenum">   22</span>             }x;
<span class="synLinenum">   23</span>   <span class="synStatement">my</span> <span class="synIdentifier">$re</span> = <span class="synConstant">qr/^ </span><span class="synIdentifier">$expr</span><span class="synConstant"> </span><span class="synIdentifier">$skip</span><span class="synConstant"> </span><span class="synSpecial">\z</span><span class="synConstant">/x</span>;
<span class="synLinenum">   24</span> <span class="synIdentifier">  </span><span class="synStatement">sub</span><span class="synIdentifier"> is_valid </span>{ <span class="synStatement">shift</span> =~<span class="synStatement"> /</span><span class="synIdentifier">$re</span><span class="synStatement">/o</span> }
<span class="synLinenum">   25</span> 
<span class="synLinenum">   26</span>   <span class="synStatement">my</span> <span class="synIdentifier">@test</span> = ( <span class="synConstant">'(a + 3)'</span>, <span class="synConstant">'(3 * 4)+(b + x)'</span>, <span class="synConstant">'(5 - a)*z'</span>,
<span class="synLinenum">   27</span>                 <span class="synConstant">'((5 - a))*((((z)))+2)'</span>, <span class="synConstant">'3 + 2'</span>, <span class="synConstant">'!3 + 2'</span>, <span class="synConstant">'3 + 2!'</span>,
<span class="synLinenum">   28</span>                 <span class="synConstant">'3 a'</span>, <span class="synConstant">'3 3'</span>, <span class="synConstant">'3 * * 3'</span>,
<span class="synLinenum">   29</span>                 <span class="synConstant">'2 - 3 * 4'</span>,  <span class="synConstant">'2 - 3 + 4'</span>,
<span class="synLinenum">   30</span>               );
<span class="synLinenum">   31</span>   <span class="synStatement">foreach</span> (<span class="synIdentifier">@test</span>) {
<span class="synLinenum">   32</span>     say(<span class="synConstant">"</span><span class="synIdentifier">$_</span><span class="synConstant">:"</span>);
<span class="synLinenum">   33</span>     say(is_valid(<span class="synIdentifier">$_</span>) ? <span class="synConstant">"</span><span class="synSpecial">\n</span><span class="synConstant">&lt;</span><span class="synIdentifier">$_</span><span class="synConstant">&gt; is valid"</span> : <span class="synConstant">"</span><span class="synSpecial">\n</span><span class="synConstant">&lt;</span><span class="synIdentifier">$_</span><span class="synConstant">&gt; is not valid"</span>)
<span class="synLinenum">   34</span>   }
</pre>

<P>
Ejecución:

<P>
<PRE>
pl@nereida:~/Lperltesting$ ./simpleexpressions.pl
(a + 3):
[(] [ID a] [OP +] [INT 3] [)]
&lt;(a + 3)&gt; is valid
(3 * 4)+(b + x):
[(] [INT 3] [OP *] [INT 4] [)] [OP +] [(] [ID b] [OP +] [ID x] [)]
&lt;(3 * 4)+(b + x)&gt; is valid
(5 - a)*z:
[(] [INT 5] [OP -] [ID a] [)] [OP *] [ID z]
&lt;(5 - a)*z&gt; is valid
((5 - a))*((((z)))+2):
[(] [(] [INT 5] [OP -] [ID a] [)] [)] [OP *] [(] [(] [(] [(] [ID z] [)] [)] [)] [OP +] [INT 2] [)]
&lt;((5 - a))*((((z)))+2)&gt; is valid
3 + 2:
[INT 3] [OP +] [INT 2]
&lt;3 + 2&gt; is valid
!3 + 2:

&lt;!3 + 2&gt; is not valid
3 + 2!:
[INT 3] [OP +] [INT 2]
&lt;3 + 2!&gt; is not valid
3 a:
[INT 3]
&lt;3 a&gt; is not valid
3 3:
[INT 3]
&lt;3 3&gt; is not valid
3 * * 3:
[INT 3] [OP *]
&lt;3 * * 3&gt; is not valid
2 - 3 * 4:
[INT 2] [OP -] [INT 3] [OP *] [INT 4]
&lt;2 - 3 * 4&gt; is valid
2 - 3 + 4:
[INT 2] [OP -] [INT 3] [OP +] [INT 4]
&lt;2 - 3 + 4&gt; is valid
</PRE>

<P>
<HR>
<A NAME="tex2html2061"
  HREF="node62.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html2055"
  HREF="node56.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html2049"
  HREF="node60.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html2057"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A> 
<A NAME="tex2html2059"
  HREF="node322.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A> <A NAME="tex2html2"
  HREF="http://nereida.deioc.ull.es/~pl/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="PL.jpg"
 ALT="PL"></A><A NAME="tex2html3"
  HREF="http://campusvirtual.ull.es/0910/course/view.php?id=1148"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="hatpl.png"
 ALT="PL moodle"></A><A NAME="tex2html4"
  HREF="pl.ps"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="gv.jpeg"
 ALT="ps"></A><A NAME="tex2html5"
  HREF="perl_errata_form.html"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="icon_errata.jpg"
 ALT="errata"></A><A NAME="tex2html6"
  HREF="http://search.cpan.org/"><IMG
  WIDTH="60" ALIGN="BOTTOM" BORDER="0"
 SRC="lupa.gif"
 ALT="modulos"></A><A NAME="tex2html7"
  HREF="http://www.perlmonks.org/?node=Seekers of Perl Wisdom"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="monk.gif"
 ALT="perlmonks"></A><A NAME="tex2html8"
  HREF="http://perldoc.perl.org/"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="perlonion.jpeg"
 ALT="perldoc"></A><A NAME="tex2html9"
  HREF="http://nereida.deioc.ull.es/~lhp/perlexamples/"><IMG
  WIDTH="22" ALIGN="BOTTOM" BORDER="0"
 SRC="logoLHP.jpg"
 ALT="apuntes LHP"></A><A NAME="tex2html10"
  HREF="http://www.google.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ggoogle.gif"
 ALT="google"></A><A NAME="tex2html11"
  HREF="http://www.etsii.ull.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="etsii.png"
 ALT="etsii"></A><A NAME="tex2html12"
  HREF="http://www.ull.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ull.gif"
 ALT="ull"></A><A NAME="tex2html13"
  HREF="http://nereida.deioc.ull.es/"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="pcgull"></A>
<BR>
<B> Sig:</B> <A NAME="tex2html2062"
  HREF="node62.html">Cuantificadores Posesivos</A>
<B>Sup:</B> <A NAME="tex2html2056"
  HREF="node56.html">Algunas Extensiones</A>
<B> Ant:</B> <A NAME="tex2html2050"
  HREF="node60.html">Definición de Nombres de</A>
 <B>Err:</B> <a href="perl_errata_form.html" target="_blank">Si hallas una errata ...</a>

<!--End of Navigation Panel-->
<ADDRESS>
<I>Casiano Rodríguez León <BR>
2013-03-05</I>
</ADDRESS>
</BODY>
</HTML>
