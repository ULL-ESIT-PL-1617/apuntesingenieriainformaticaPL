<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">

<!--Converted with LaTeX2HTML 2008 (1.71)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>Práctica: Números de Línea, Errores, Cadenas y Comentarios</TITLE>
<META NAME="description" CONTENT="Práctica: Números de Línea, Errores, Cadenas y Comentarios">
<META NAME="keywords" CONTENT="perlexamples">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META NAME="Generator" CONTENT="LaTeX2HTML v2008">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="mystyle.css">

<LINK REL="previous" HREF="node117.html">
<LINK REL="up" HREF="node112.html">
<LINK REL="next" HREF="node119.html">
</HEAD>

<BODY >

<A NAME="tex2html3137"
  HREF="node119.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html3131"
  HREF="node112.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html3127"
  HREF="node117.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html3133"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A> 
<A NAME="tex2html3135"
  HREF="node322.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A> <A NAME="tex2html2"
  HREF="http://nereida.deioc.ull.es/~pl/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="PL.jpg"
 ALT="PL"></A><A NAME="tex2html3"
  HREF="http://campusvirtual.ull.es/0910/course/view.php?id=1148"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="hatpl.png"
 ALT="PL moodle"></A><A NAME="tex2html4"
  HREF="pl.ps"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="gv.jpeg"
 ALT="ps"></A><A NAME="tex2html5"
  HREF="perl_errata_form.html"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="icon_errata.jpg"
 ALT="errata"></A><A NAME="tex2html6"
  HREF="http://search.cpan.org/"><IMG
  WIDTH="60" ALIGN="BOTTOM" BORDER="0"
 SRC="lupa.gif"
 ALT="modulos"></A><A NAME="tex2html7"
  HREF="http://www.perlmonks.org/?node=Seekers of Perl Wisdom"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="monk.gif"
 ALT="perlmonks"></A><A NAME="tex2html8"
  HREF="http://perldoc.perl.org/"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="perlonion.jpeg"
 ALT="perldoc"></A><A NAME="tex2html9"
  HREF="http://nereida.deioc.ull.es/~lhp/perlexamples/"><IMG
  WIDTH="22" ALIGN="BOTTOM" BORDER="0"
 SRC="logoLHP.jpg"
 ALT="apuntes LHP"></A><A NAME="tex2html10"
  HREF="http://www.google.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ggoogle.gif"
 ALT="google"></A><A NAME="tex2html11"
  HREF="http://www.etsii.ull.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="etsii.png"
 ALT="etsii"></A><A NAME="tex2html12"
  HREF="http://www.ull.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ull.gif"
 ALT="ull"></A><A NAME="tex2html13"
  HREF="http://nereida.deioc.ull.es/"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="pcgull"></A>
<BR>
<B> Sig:</B> <A NAME="tex2html3138"
  HREF="node119.html">Pruebas para el Analizador</A>
<B>Sup:</B> <A NAME="tex2html3132"
  HREF="node112.html">Análisis Léxico</A>
<B> Ant:</B> <A NAME="tex2html3128"
  HREF="node117.html">Ejercicio: El or es</A>
 <B>Err:</B> <a href="perl_errata_form.html" target="_blank">Si hallas una errata ...</a>
<BR> <P>

<!--End of Navigation Panel-->

<H2><A NAME="SECTION00936000000000000000"></A>
   <A NAME="9958"></A>
  
<A NAME="practica:lineasyerrores"></A>
<BR>
Práctica: Números de Línea, Errores, Cadenas y Comentarios
</H2>
Extienda el analizador léxico para que:

<UL>
<LI>Reescriba la expresión regular para las cadenas de manera que acepte comillas dobles 
escapadas <code>\"</code> en el interior de una cadena.
Por ejemplo en <code>"esta \"palabra\" va entre comillas"</code>.

<P>
Analice esta solución ¿Es correcta?:
<PRE>
 DB&lt;1&gt; $stringre = qr{"(\\.|[^\\"])*"}
 DB&lt;2&gt; print $&amp; if '"esta \"palabra\" va entre comillas"' =~ $stringre
 "esta \"palabra\" va entre comillas"
</PRE>

<P>
</LI>
<LI>Consuma comentarios a la Perl: 
cualesquiera caracteres después de una almohadilla hasta el final 
de la línea (<code># ...</code>).
</LI>
<LI>Consuma comentarios no anidados a la <B>C</B> (<code>/* ... */</code>.).
Repase las secciones sobre expresiones regulares no ``greedy'' (p. ej. sección
<A HREF="node50.html#section:nogreedy">3.1.1</A>) y la sección <A HREF="node50.html#section:x">3.1.1</A>.
Recuerde que, en una expresión regular, 
la opción <code>/s</code> hace que el punto <code>'.'</code> empareje con un 
retorno de carro <code>\n</code>.  Esto es, el punto ``casa'' con cualquier carácter.

<P>
Observe el siguiente ejemplo:
<PRE>
pl@nereida:~/src/perl/testing$ cat -n ccomments.pl
 1  #!/usr/bin/perl -w
 2  use strict;
 3
 4  sub showmatches {
 5   my ($x, $re) = @_;
 6
 7    for (my $i = 0; $x =~ /$re/gsx; $i++) {
 8      print "matching $i: $1\n";
 9      $i++;
10    }
11  }
12
13  my $x = &lt;&lt;'EOC';
14  if (x) {
15    /* a comment */ return x + 1; /* another comment */
16  }
17  else {
18    return x + 2; /* a last comment */
19  }
20  EOC
21
22  print "\n************************\n";
23
24  my $greedy = q{ (
25           /\*  # Abrir comentario
26           .*   # Consumir caracteres (greedy)
27           \*/  # Cerrar comentario
28           )
29  };
30  print "Greedy:\n";
31  showmatches($x, $greedy);
32
33  print "\n************************\n";
34
35  my $lazy = q{ (
36           /\*  # Abrir comentario
37           .*?  # Consumir caracteres (lazy)
38           \*/  # Cerrar comentario
39           )
40  };
41  print "Lazy:\n";
42  showmatches($x, $lazy);
</PRE>
Cuando se ejecuta produce:
<PRE>
pl@nereida:~/src/perl/testing$ ccomments.pl

************************
Greedy:
matching 0: /* a comment */ return x + 1; /* another comment */
}
else {
  return x + 2; /* a last comment */

************************
Lazy:
matching 0: /* a comment */
matching 2: /* another comment */
matching 4: /* a last comment */
</PRE>

<P>
Explique la conducta.

<P>
</LI>
<LI>Números en punto flotante (como <code>-1.32e-04</code> o <code>.91</code>).
El siguiente ejemplo intenta ayudarle en la búsqueda de la solución:
<PRE>
lhp@nereida:~$ perl -de 0
  DB&lt;1&gt; print "Si" if  ('.5' =~ m{\d+})
Si
  DB&lt;2&gt; print "Si" if  ('.5' =~ m{^\d+})

  DB&lt;3&gt; print "Si" if  '0.7' =~ m{^\d+(\.\d+)?(e[+-]?\d+)?$}
Si
  DB&lt;4&gt; print "Si" if  '.7' =~ m{^\d+(\.\d+)?(e[+-]?\d+)?$}

  DB&lt;5&gt; print "Si" if  '1e2' =~ m{^\d+(\.\d+)?(e[+-]?\d+)?$}
Si
  DB&lt;6&gt; print "Si " while  'ababa' =~ m{a}g
Si Si Si
  DB&lt;7&gt; print "@a" if @a = 'ababa' =~ m{(a)}g
a a a
</PRE>
¿Sabría decir porque la respuesta al primer comando del depurador es
<code>si</code>?.

<P>
</LI>
<LI>Tenga presente el posible conflicto entre los terminales <code>INT</code> y <code>FLOAT</code>.
Si la entrada contiene <code>3.5</code> el terminal debería ser <code>(FLOAT, '3.5')</code>
y no <code>(INT, 3), ('.', '.'), (INT, 5)</code>.

<P>
</LI>
<LI>En esta práctica si lo desea puede instalar y usar 
<A NAME="tex2html215"
  HREF="http://search.cpan.org/~abigail/Regexp-Common-2.120/lib/Regexp/Common.pm">el módulo</A>
Regexp::Common 
<A NAME="tex2html216"
  HREF="http://search.cpan.org/~abigail/">mantenido por</A>
<A NAME="9959"></A><B>Abigail</B> el cual provee expresiones regulares para las situaciones mas comunes: números, 
teléfonos, IP, códigos postales, listas, etc. Puede incluso usarlo para encontrar 
soluciones a las cuestiones planteadas en esta práctica:

<P>
<PRE>
nereida:~/doc/casiano/PLBOOK/PLBOOK&gt; perl -MRegexp::Common -e 'print "$RE{num}{int}\n"'
(?:(?:[+-]?)(?:[0123456789]+))
</PRE>
Podemos hacer uso directo del hash <code>%RE</code> directamente 
en las expresiones regulares aprovechando que estas interpolan
las variables en su interior:
 <PRE>
nereida:/tmp&gt; cat -n prueba.pl
     1  #!/usr/bin/perl -w
     2  use strict;
     3  use Regexp::Common;
     4
     5  my $input = &lt;&gt;;
     6
     7  print "$&amp;\n" if $input =~ /^$RE{num}{real}$/;
nereida:/tmp&gt; ./prueba.pl
23.45
23.45
nereida:/tmp&gt; ./prueba.pl
jshdf
nereida:/tmp&gt;
</PRE>
</LI>
<LI>Para mejorar la calidad de los mensajes de error extienda el par <code>(terminal, valor)</code>
devuelto por el <code>scanner</code> a un par <code>(terminal, [valor, número de línea ])</code> cuya
segunda componente es un array anónimo conteniendo 
el valor y el número de línea en el que aparece el terminal.

<P>
El siguiente extracto de un analizador léxico muestra como hacerlo:

<P>
<PRE>
sub _Lexer {

  return('', undef) unless defined($input);

  #Skip blanks
      $input=~m{\G((?:
              \s+       # any white space char
          |   \#[^\n]*  # Perl like comments
          )+)}xsgc
    and do {
        my($blanks)=$1;

        #Maybe At EOF
            pos($input) &gt;= length($input)
        and return('', undef);
        $tokenend += $blanks =~ tr/\n//;
    };
    
    $tokenbegin = $tokenend;

      $input=~/\G(and)/gc
    and return($1, [$1, $tokenbegin]);

      $input=~/\G(?:[A-Za-z_][A-Za-z0-9_]*::)*([A-Za-z_][A-Za-z0-9_]*)/gc
    and do {
      return('IDENT', [$1, $tokenbegin]);
    };

    ....................

        $input=~/\G{/gc
    and do {
        my($level,$from,$code);

        $from=pos($input);

        $level=1;
        while($input=~/([{}])/gc) {
                substr($input,pos($input)-1,1) eq '\\' #Quoted
            and next;
                $level += ($1 eq '{' ? 1 : -1)
            or last;
        }
            $level
        and  _SyntaxError("Not closed open curly bracket { at $tokenbegin");
        $code = substr($input,$from,pos($input)-$from-1);
        $tokenend+= $code=~tr/\n//;
        return('CODE', [$code, $tokenbegin]);
    };


    #Always return something
      $input=~/\G(.)/sg
    and do {
      $1 eq "\n" and ++$tokenend;
      return ($1, [$1, $tokenbegin]);
    };
    #At EOF
    return('', undef);
}
</PRE>
El operador <code>tr</code> ha sido utilizado para contar los retornos de carro
(descrito en la sección 
<A HREF="node78.html#section:tr">3.5</A>). El operador, ademas de reemplazar
devuelve el número de carácteres reeemplazados
o suprimidos: 
<PRE>
$cuenta = $cielo =~ tr/*/*/; # cuenta el numero de estrellas en cielo
</PRE>
Para aprender soluciones alternativas consulte 
<code>perldoc -q 'substring'</code>.
</LI>
<LI>Mejore sus mensajes de error ahora que lleva la cuenta de los números
de línea. En vez de usar las rutinas <code>error</code> y <code>fatal</code>
introducidas en la sección anterior escriba una sola rutina
que recibe el nivel de severidad del error (parámetro <code>$level</code>
en el siguiente ejemplo)
y ejecuta la acción apropiada. El código de <code>_SyntaxError</code>
ilustra como hacerlo:
<PRE>
sub _SyntaxError {
  my($level,$message,$lineno)=@_;

  $message= "*".
      [ 'Warning', 'Error', 'Fatal' ]-&gt;[$level].
      "* $message, at ".
      ($lineno &lt; 0 ? "eof" : "line $lineno")." at file $filename\n";

      $level &gt; 1
  and die $message;

  warn $message;

  $level &gt; 0 and ++$nberr;

      $nberr == $max_errors
  and die "*Fatal* Too many errors detected.\n"
}
</PRE>

<P>
</LI>
</UL>

<P>
<HR>
<A NAME="tex2html3137"
  HREF="node119.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html3131"
  HREF="node112.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html3127"
  HREF="node117.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html3133"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A> 
<A NAME="tex2html3135"
  HREF="node322.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A> <A NAME="tex2html2"
  HREF="http://nereida.deioc.ull.es/~pl/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="PL.jpg"
 ALT="PL"></A><A NAME="tex2html3"
  HREF="http://campusvirtual.ull.es/0910/course/view.php?id=1148"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="hatpl.png"
 ALT="PL moodle"></A><A NAME="tex2html4"
  HREF="pl.ps"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="gv.jpeg"
 ALT="ps"></A><A NAME="tex2html5"
  HREF="perl_errata_form.html"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="icon_errata.jpg"
 ALT="errata"></A><A NAME="tex2html6"
  HREF="http://search.cpan.org/"><IMG
  WIDTH="60" ALIGN="BOTTOM" BORDER="0"
 SRC="lupa.gif"
 ALT="modulos"></A><A NAME="tex2html7"
  HREF="http://www.perlmonks.org/?node=Seekers of Perl Wisdom"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="monk.gif"
 ALT="perlmonks"></A><A NAME="tex2html8"
  HREF="http://perldoc.perl.org/"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="perlonion.jpeg"
 ALT="perldoc"></A><A NAME="tex2html9"
  HREF="http://nereida.deioc.ull.es/~lhp/perlexamples/"><IMG
  WIDTH="22" ALIGN="BOTTOM" BORDER="0"
 SRC="logoLHP.jpg"
 ALT="apuntes LHP"></A><A NAME="tex2html10"
  HREF="http://www.google.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ggoogle.gif"
 ALT="google"></A><A NAME="tex2html11"
  HREF="http://www.etsii.ull.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="etsii.png"
 ALT="etsii"></A><A NAME="tex2html12"
  HREF="http://www.ull.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ull.gif"
 ALT="ull"></A><A NAME="tex2html13"
  HREF="http://nereida.deioc.ull.es/"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="pcgull"></A>
<BR>
<B> Sig:</B> <A NAME="tex2html3138"
  HREF="node119.html">Pruebas para el Analizador</A>
<B>Sup:</B> <A NAME="tex2html3132"
  HREF="node112.html">Análisis Léxico</A>
<B> Ant:</B> <A NAME="tex2html3128"
  HREF="node117.html">Ejercicio: El or es</A>
 <B>Err:</B> <a href="perl_errata_form.html" target="_blank">Si hallas una errata ...</a>

<!--End of Navigation Panel-->
<ADDRESS>
<I>Casiano Rodríguez León <BR>
2013-03-05</I>
</ADDRESS>
</BODY>
</HTML>
