<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">

<!--Converted with LaTeX2HTML 2008 (1.71)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>Construcción de las Declaraciones de Tipo con hnew</TITLE>
<META NAME="description" CONTENT="Construcción de las Declaraciones de Tipo con hnew">
<META NAME="keywords" CONTENT="perlexamples">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META NAME="Generator" CONTENT="LaTeX2HTML v2008">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="mystyle.css">

<LINK REL="next" HREF="node299.html">
<LINK REL="previous" HREF="node297.html">
<LINK REL="up" HREF="node294.html">
<LINK REL="next" HREF="node299.html">
</HEAD>

<BODY >

<A NAME="tex2html6038"
  HREF="node299.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html6032"
  HREF="node294.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html6026"
  HREF="node297.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html6034"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A> 
<A NAME="tex2html6036"
  HREF="node322.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A> <A NAME="tex2html2"
  HREF="http://nereida.deioc.ull.es/~pl/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="PL.jpg"
 ALT="PL"></A><A NAME="tex2html3"
  HREF="http://campusvirtual.ull.es/0910/course/view.php?id=1148"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="hatpl.png"
 ALT="PL moodle"></A><A NAME="tex2html4"
  HREF="pl.ps"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="gv.jpeg"
 ALT="ps"></A><A NAME="tex2html5"
  HREF="perl_errata_form.html"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="icon_errata.jpg"
 ALT="errata"></A><A NAME="tex2html6"
  HREF="http://search.cpan.org/"><IMG
  WIDTH="60" ALIGN="BOTTOM" BORDER="0"
 SRC="lupa.gif"
 ALT="modulos"></A><A NAME="tex2html7"
  HREF="http://www.perlmonks.org/?node=Seekers of Perl Wisdom"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="monk.gif"
 ALT="perlmonks"></A><A NAME="tex2html8"
  HREF="http://perldoc.perl.org/"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="perlonion.jpeg"
 ALT="perldoc"></A><A NAME="tex2html9"
  HREF="http://nereida.deioc.ull.es/~lhp/perlexamples/"><IMG
  WIDTH="22" ALIGN="BOTTOM" BORDER="0"
 SRC="logoLHP.jpg"
 ALT="apuntes LHP"></A><A NAME="tex2html10"
  HREF="http://www.google.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ggoogle.gif"
 ALT="google"></A><A NAME="tex2html11"
  HREF="http://www.etsii.ull.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="etsii.png"
 ALT="etsii"></A><A NAME="tex2html12"
  HREF="http://www.ull.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ull.gif"
 ALT="ull"></A><A NAME="tex2html13"
  HREF="http://nereida.deioc.ull.es/"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="pcgull"></A>
<BR>
<B> Sig:</B> <A NAME="tex2html6039"
  HREF="node299.html">Inicio de los Tipos</A>
<B>Sup:</B> <A NAME="tex2html6033"
  HREF="node294.html">Análisis de Tipos</A>
<B> Ant:</B> <A NAME="tex2html6027"
  HREF="node297.html">Expresiones de Tipo en</A>
 <B>Err:</B> <a href="perl_errata_form.html" target="_blank">Si hallas una errata ...</a>
<BR> <P>

<!--End of Navigation Panel-->

<H1><A NAME="SECTION001840000000000000000"></A>
<A NAME="section:hnew"></A>
<BR>
Construcción de las Declaraciones de Tipo con <TT>hnew</TT>
</H1>
Una manera aún mas conveniente de representar una expresión 
de tipo es atraves de un <A NAME="26663"></A><B>grafo dirigido acíclico</B> 
o <A NAME="26665"></A><B>DAG</B> (<A NAME="26667"></A><B>Directed Acyclic Graph</B>).

<P>

<H4><A NAME="SECTION001840010000000000000">
<TT>hnew</TT></A>
</H4>
  

<P>
Parse::Eyapp provee el método  Parse::Eyapp::Node-&gt;hnew  
el cual facilita  la construcción  de DAGs. El método <code>hnew</code>
trabaja siguiendo lo que en programación funcional se denomina
<A NAME="26674"></A><B>hashed consing</B>. En  <A NAME="26676"></A><B>Lisp</B> la función de asignación 
de memoria es  cons  y la forma habitual de compartición 
es a través de una tabla hash. 
Hash consing es una técnica para compartir datos que son estructuralmente
iguales. De esta forma se ahorra memoria.
La técnica esta relacionada con - puede considerarse una aplicación concreta 
de - la técnica conocida con 
el nombre de <A NAME="26678"></A><B>memoization</B><A HREF="#subsection:memoizing">
<IMG  ALIGN="BOTTOM" BORDER="1" ALT="[*]" SRC="crossref.png"></A> 
[<A
 HREF="node323.html#CasianoIntroAPerl">4</A>]. 
Si alguno de los subárboles
(o el árbol) fueron creados anteriormente no serán creados
de nuevo sino que <code>hnew</code> retorna una referencia 
al ya existente.  Esto hace mas rápida la comprobación de tipos:
<B>en vez de comprobar que los dos árboles son estructuralmente
equivalentes basta con comprobar que las referencias son iguales</B>.
Asi la comprobación de la equivalencia de tipos pasa a requerir
tiempo constante.

<P>
Observe los siguientes comandos:

<P>
<PRE>
 DB&lt;2&gt; x $a = Parse::Eyapp::Node-&gt;hnew('F(X_3(A_3(A_5(INT)), CHAR, A_5(INT)),CHAR)')
0  F=HASH(0x85f6a20)
   'children' =&gt; ARRAY(0x85e92e4)
   |- 0  X_3=HASH(0x83f55fc)
   |     'children' =&gt; ARRAY(0x83f5608)
   |     |- 0  A_3=HASH(0x85a0488)
   |     |     'children' =&gt; ARRAY(0x859fad4)
   |     |        0  A_5=HASH(0x85e5d3c)
   |     |           'children' =&gt; ARRAY(0x83f4120)
   |     |              0  INT=HASH(0x83f5200)
   |     |                 'children' =&gt; ARRAY(0x852ccb4)
   |     |                      empty array
   |     |- 1  CHAR=HASH(0x8513564)
   |     |     'children' =&gt; ARRAY(0x852cad4)
   |     |          empty array
   |     `- 2  A_5=HASH(0x85e5d3c)
   |           -&gt; REUSED_ADDRESS
   `- 1  CHAR=HASH(0x8513564)
         -&gt; REUSED_ADDRESS
 DB&lt;3&gt; x $a-&gt;str
0  'F(X_3(A_3(A_5(INT)),CHAR,A_5(INT)),CHAR)'
</PRE>

<P>
La segunda aparición de <code>A_5(INT)</code> aparece etiquetada como reusada (tercer hijo de 
<code>X_3</code>). Lo mismo ocurre con la segunda aparición de <code>CHAR</code>.

<P>

<H4><A NAME="SECTION001840020000000000000">
<TT>hnew</TT> y el Manejador de Atributos</A>
</H4>
  

<P>
El valor asignado a los atributos no influye en la memoización de <code>hnew</code>: si los
términos tienen la misma forma se devolverán los mismos árboles:

<P>
<PRE>
pl@nereida:~/src/perl/testing$ perl -MParse::Eyapp::Node -wde 0
main::(-e:1):   0
  DB&lt;1&gt; @x = Parse::Eyapp::Node-&gt;hnew('A(B,C(D))', sub { $_-&gt;{n} = $i++ for @_ })
  DB&lt;2&gt; @y = Parse::Eyapp::Node-&gt;hnew('C(D)', sub { $_-&gt;{t} = 10-$j++ for @_ })
  DB&lt;3&gt; x @x
0  A=HASH(0x850935c)
   'children' =&gt; ARRAY(0x8509530)
      0  B=HASH(0x85095a8)
         'children' =&gt; ARRAY(0x8326800)
              empty array
         'n' =&gt; 1
      1  C=HASH(0x8509410)
         'children' =&gt; ARRAY(0x85094dc)
            0  D=HASH(0x85094b8)
               'children' =&gt; ARRAY(0x85095f0)
                    empty array
               'n' =&gt; 3
               't' =&gt; 9
         'n' =&gt; 2
         't' =&gt; 10
   'n' =&gt; 0
1  B=HASH(0x85095a8)
   -&gt; REUSED_ADDRESS
2  C=HASH(0x8509410)
   -&gt; REUSED_ADDRESS
3  D=HASH(0x85094b8)
   -&gt; REUSED_ADDRESS
  DB&lt;4&gt; x @y
0  C=HASH(0x8509410)
   'children' =&gt; ARRAY(0x85094dc)
      0  D=HASH(0x85094b8)
         'children' =&gt; ARRAY(0x85095f0)
              empty array
         'n' =&gt; 3
         't' =&gt; 9
   'n' =&gt; 2
   't' =&gt; 10
1  D=HASH(0x85094b8)
   -&gt; REUSED_ADDRESS
</PRE>

<P>

<H4><A NAME="SECTION001840030000000000000">
La Función <TT>build_function_scope</TT></A>
</H4>
  

<P>
Sigue el código de la función 
<code>build_function_scope</code>:
<PRE>
pl@nereida:~/doc/casiano/PLBOOK/PLBOOK/code/Simple-Types/lib/Simple$ \
                  sed -ne '/sub bu.*scop/,/^}/p' Types.eyp | cat -n
 1  sub build_function_scope {
 2    my ($funcDef, $returntype) = @_;
 3
 4    my $function_name = $funcDef-&gt;{function_name}[0];
 5    my @parameters = @{$funcDef-&gt;{parameters}};
 6    my $lst = $funcDef-&gt;{symboltable};
 7    my $numargs = scalar(@parameters);
 8
 9    #compute type
10    my $partype = "";
11    my @types = map { $lst-&gt;{$_}{type} } @parameters;
12    $partype .= join ",", @types if @types;
13
14    my $type = "F(X_$numargs($partype),$returntype)";
15
16    #insert it in the hash of types
17    $type{$type} = Parse::Eyapp::Node-&gt;hnew($type);
18    $funcDef-&gt;{type} = $type;
19    $funcDef-&gt;{t} = $type{$type};
20
21    #insert it in the global symbol table
22    die "Duplicated declaration of $function_name at line $funcDef-&gt;{function_name}[1]\n"
23      if exists($st{$function_name});
24    $st{$function_name}-&gt;{type} = $type;
25    $st{$function_name}-&gt;{line} = $funcDef-&gt;{function_name}[1];
26
27    return $funcDef;
28  }
</PRE>
Obsérvese que para acelerar los accesos al atributo tipo
dotamos a los nodos del atributo <code>t</code> que 
permite acceder directamente al DAG representando el tipo.

<P>
<BR> <HR>
<!--Table of Child-Links-->
<A NAME="CHILD_LINKS"><STRONG>Subsecciones</STRONG></A>

<UL>
<LI><UL>
<LI><UL>
<LI><A NAME="tex2html6040"
  HREF="node298.html#SECTION001840010000000000000"><TT>hnew</TT></A>
<LI><A NAME="tex2html6041"
  HREF="node298.html#SECTION001840020000000000000"><TT>hnew</TT> y el Manejador de Atributos</A>
<LI><A NAME="tex2html6042"
  HREF="node298.html#SECTION001840030000000000000">La Función <TT>build_function_scope</TT></A>
</UL></UL></UL>
<!--End of Table of Child-Links-->
<HR>
<A NAME="tex2html6038"
  HREF="node299.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html6032"
  HREF="node294.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html6026"
  HREF="node297.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html6034"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A> 
<A NAME="tex2html6036"
  HREF="node322.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A> <A NAME="tex2html2"
  HREF="http://nereida.deioc.ull.es/~pl/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="PL.jpg"
 ALT="PL"></A><A NAME="tex2html3"
  HREF="http://campusvirtual.ull.es/0910/course/view.php?id=1148"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="hatpl.png"
 ALT="PL moodle"></A><A NAME="tex2html4"
  HREF="pl.ps"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="gv.jpeg"
 ALT="ps"></A><A NAME="tex2html5"
  HREF="perl_errata_form.html"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="icon_errata.jpg"
 ALT="errata"></A><A NAME="tex2html6"
  HREF="http://search.cpan.org/"><IMG
  WIDTH="60" ALIGN="BOTTOM" BORDER="0"
 SRC="lupa.gif"
 ALT="modulos"></A><A NAME="tex2html7"
  HREF="http://www.perlmonks.org/?node=Seekers of Perl Wisdom"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="monk.gif"
 ALT="perlmonks"></A><A NAME="tex2html8"
  HREF="http://perldoc.perl.org/"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="perlonion.jpeg"
 ALT="perldoc"></A><A NAME="tex2html9"
  HREF="http://nereida.deioc.ull.es/~lhp/perlexamples/"><IMG
  WIDTH="22" ALIGN="BOTTOM" BORDER="0"
 SRC="logoLHP.jpg"
 ALT="apuntes LHP"></A><A NAME="tex2html10"
  HREF="http://www.google.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ggoogle.gif"
 ALT="google"></A><A NAME="tex2html11"
  HREF="http://www.etsii.ull.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="etsii.png"
 ALT="etsii"></A><A NAME="tex2html12"
  HREF="http://www.ull.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ull.gif"
 ALT="ull"></A><A NAME="tex2html13"
  HREF="http://nereida.deioc.ull.es/"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="pcgull"></A>
<BR>
<B> Sig:</B> <A NAME="tex2html6039"
  HREF="node299.html">Inicio de los Tipos</A>
<B>Sup:</B> <A NAME="tex2html6033"
  HREF="node294.html">Análisis de Tipos</A>
<B> Ant:</B> <A NAME="tex2html6027"
  HREF="node297.html">Expresiones de Tipo en</A>
 <B>Err:</B> <a href="perl_errata_form.html" target="_blank">Si hallas una errata ...</a>

<!--End of Navigation Panel-->
<ADDRESS>
<I>Casiano Rodríguez León <BR>
2013-03-05</I>
</ADDRESS>
</BODY>
</HTML>
