<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">

<!--Converted with LaTeX2HTML 2008 (1.71)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>Comprobación de Tipos: Llamadas a Funciones</TITLE>
<META NAME="description" CONTENT="Comprobación de Tipos: Llamadas a Funciones">
<META NAME="keywords" CONTENT="perlexamples">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META NAME="Generator" CONTENT="LaTeX2HTML v2008">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="mystyle.css">

<LINK REL="next" HREF="node307.html">
<LINK REL="previous" HREF="node305.html">
<LINK REL="up" HREF="node294.html">
<LINK REL="next" HREF="node307.html">
</HEAD>

<BODY >

<A NAME="tex2html6167"
  HREF="node307.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html6161"
  HREF="node294.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html6155"
  HREF="node305.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html6163"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A> 
<A NAME="tex2html6165"
  HREF="node322.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A> <A NAME="tex2html2"
  HREF="http://nereida.deioc.ull.es/~pl/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="PL.jpg"
 ALT="PL"></A><A NAME="tex2html3"
  HREF="http://campusvirtual.ull.es/0910/course/view.php?id=1148"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="hatpl.png"
 ALT="PL moodle"></A><A NAME="tex2html4"
  HREF="pl.ps"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="gv.jpeg"
 ALT="ps"></A><A NAME="tex2html5"
  HREF="perl_errata_form.html"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="icon_errata.jpg"
 ALT="errata"></A><A NAME="tex2html6"
  HREF="http://search.cpan.org/"><IMG
  WIDTH="60" ALIGN="BOTTOM" BORDER="0"
 SRC="lupa.gif"
 ALT="modulos"></A><A NAME="tex2html7"
  HREF="http://www.perlmonks.org/?node=Seekers of Perl Wisdom"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="monk.gif"
 ALT="perlmonks"></A><A NAME="tex2html8"
  HREF="http://perldoc.perl.org/"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="perlonion.jpeg"
 ALT="perldoc"></A><A NAME="tex2html9"
  HREF="http://nereida.deioc.ull.es/~lhp/perlexamples/"><IMG
  WIDTH="22" ALIGN="BOTTOM" BORDER="0"
 SRC="logoLHP.jpg"
 ALT="apuntes LHP"></A><A NAME="tex2html10"
  HREF="http://www.google.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ggoogle.gif"
 ALT="google"></A><A NAME="tex2html11"
  HREF="http://www.etsii.ull.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="etsii.png"
 ALT="etsii"></A><A NAME="tex2html12"
  HREF="http://www.ull.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ull.gif"
 ALT="ull"></A><A NAME="tex2html13"
  HREF="http://nereida.deioc.ull.es/"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="pcgull"></A>
<BR>
<B> Sig:</B> <A NAME="tex2html6168"
  HREF="node307.html">Comprobación de Tipos: Sentencia</A>
<B>Sup:</B> <A NAME="tex2html6162"
  HREF="node294.html">Análisis de Tipos</A>
<B> Ant:</B> <A NAME="tex2html6156"
  HREF="node305.html">Comprobación de Tipos: Sentencias</A>
 <B>Err:</B> <a href="perl_errata_form.html" target="_blank">Si hallas una errata ...</a>
<BR> <P>

<!--End of Navigation Panel-->

<H1><A NAME="SECTION0018120000000000000000"></A>
<A NAME="section:llamadasafuncion"></A>
<BR>
Comprobación de Tipos: Llamadas a Funciones
</H1>

<P>

<H4><A NAME="SECTION0018120010000000000000">
Guía de Ruta para la Comprobación de Tipos de las LLamadas</A>
</H4>
  

<P>
La comprobación de tipos en una llamada a función 
conlleva los siguientes pasos:

<OL>
<LI>Líneas 4 y 5: comprobamos que la variable que se usa en la llamada
fue efectivamente declarada como función
</LI>
<LI>Línea 14: El número de argumentos y el número de parámetros declarados
debe coincidir
</LI>
<LI>En las líneas de la 19 a la 35 analizamos la compatibilidad de tipo de cada uno
de los argumentos con su correspondiente parámetro:

<OL>
<LI>En la línea 21 se obtiene el nodo correspondiente al argumento.
Si es necesario se harán las coherciones (líneas 22 y 23)
</LI>
<LI>En la línea 25 comprobamos la compatibilidad de tipos.
En el caso de los arrays la compatibilidad no se limita a
la igualdad de referencias: consideraremos compatibles
arrays que difieren en la primera dimensión. Así
las declaraciones 
<code>int a[10][20]</code> y  <code>int b[5][20]</code> se considerarán compatibles
pero <code>int c[10][10]</code> y  <code>int d[10][20]</code> no.
</LI>
</OL>

<P>
</LI>
</OL>

<P>

<H4><A NAME="SECTION0018120020000000000000">
La forma del Árbol de las LLamadas</A>
</H4>
  

<P>
La siguiente sesión con el depurador ilustra la forma del árbol de análisis
en las llamadas:
<PRE>
pl@nereida:~/Lbook/code/Simple-Types/script$ perl -wd usetypes.pl prueba23.c 2
main::(usetypes.pl:5):  my $filename = shift || die "Usage:\n$0 file.c\n";
  DB&lt;1&gt; f Types.eyp
1       2       3       4       5       6       7       #line 8 "Types.eyp"
8
9:      use strict;
10:     use Carp;
  DB&lt;2&gt; c 598
 1 int f(char a[10], int b) {
 2   return a[5];
 3 }
 4
 5 int h(int x) {
 6   return x*2;
 7 }
 8
 9 int g() {
10   char x[5];
11   int y[19][30];
12   f(x,h(y[1][1]));
13 }
Simple::Types::compile(Types.eyp:598):
598:     set_types($t);        # Init basic types
</PRE>
Ejecutamos hasta la línea 598, justo después de terminar
el análisis de ámbito y antes de comenzar con la fase de comprobación de tipos.

<P>
A continuación mostramos una versión compacta del árbol. Para ello suprimimos
la salida de notas a pie de página ''vaciando'' el método <code>footnotes</code>:

<P>
<PRE>
  DB&lt;3&gt; insert_method(qw{PROGRAM FUNCTION}, 'footnote', sub {}) # Avoid footnotes
  DB&lt;4&gt; p $t-&gt;str
PROGRAM(
  FUNCTION[f](RETURN(VARARRAY(TERMINAL[a:2],INDEXSPEC(INUM(TERMINAL[5:2]))))),
  FUNCTION[h](RETURN(TIMES(VAR(TERMINAL[x:6]),INUM(TERMINAL[2:6])))),
  FUNCTION[g](
    FUNCTIONCALL(
      TERMINAL[f:12],
      ARGLIST(
        VAR(TERMINAL[x:12]),
        FUNCTIONCALL(
          TERMINAL[h:12],
          ARGLIST(VARARRAY(TERMINAL[y:12],INDEXSPEC(INUM(TERMINAL[1:12]),INUM(TERMINAL[1:12]))))
)))))
  DB&lt;6&gt; p $t-&gt;descendant(".2.0")-&gt;str
FUNCTIONCALL(
  TERMINAL[f:12],
  ARGLIST(
    VAR(TERMINAL[x:12]),
    FUNCTIONCALL(
      TERMINAL[h:12],
      ARGLIST(VARARRAY(TERMINAL[y:12],INDEXSPEC(INUM(TERMINAL[1:12]),INUM(TERMINAL[1:12])))))))
  DB&lt;7&gt; p $t-&gt;descendant(".2.0")-&gt;{t}-&gt;str
F(X_2(A_10(CHAR),INT),INT)
</PRE>

<P>
La sesión ilustra como la función <code>insert_method</code> puede ser utilizada para
introducir métodos en las clases influyendo en la presentación del árbol. Veamos un
segundo ejemplo en el que eliminamos la presentación de la información
asociada con los nodos:

<P>
<PRE>
  DB&lt;8&gt; insert_method(qw{FUNCTION TERMINAL}, 'info', sub {})
  DB&lt;9&gt; x $t-&gt;str
0  'PROGRAM(
      FUNCTION(RETURN(VARARRAY(TERMINAL,INDEXSPEC(INUM(TERMINAL))))),
      FUNCTION(RETURN(TIMES(VAR(TERMINAL),INUM(TERMINAL)))),
      FUNCTION(
        FUNCTIONCALL(TERMINAL,ARGLIST(VAR(TERMINAL),i
          FUNCTIONCALL(
            TERMINAL,
            ARGLIST(VARARRAY(TERMINAL,INDEXSPEC(INUM(TERMINAL),INUM(TERMINAL)))))))))'
</PRE>

<P>

<H4><A NAME="SECTION0018120030000000000000">
Código de Comprobación de las LLamadas</A>
</H4>
  

<P>
Sigue el código de comprobación de tipos de las llamadas:
<PRE>
pl@nereida:~/doc/casiano/PLBOOK/PLBOOK/code/Simple-Types/lib/Simple$ \
                           sed -ne '/^func/,234p' Trans.trg | cat -n
 1  functioncall: FUNCTIONCALL($f, ARGLIST)
 2    =&gt; {
 3      # Before type checking attribute "t" has the declaration of $f
 4      my $ftype = $FUNCTIONCALL-&gt;{t};
 5
 6       type_error(" Variable '".$f-&gt;value."' was not declared as function", $f-&gt;line)
 7      unless $ftype-&gt;isa("F");
 8
 9      my @partypes = $ftype-&gt;child(0)-&gt;children;
10
11      my @args = $ARGLIST-&gt;children;    # actual arguments
12      my $numargs = @args;    # Number of actual arguments
13      my $numpar = @partypes; # Number of declared parameters
14
15      # Check number of args
16        type_error("Function '".$f-&gt;value."' called with $numargs args expected $numpar",$f-&gt;line)
17      if ($numargs != $numpar);
18
19      # Check type compatibility between args
20      # Do type cohercion if needed
21      for (0..$#args) {
22        my $pt = shift @partypes;
23        my $ch = $ARGLIST-&gt;child($_);
24        $ch = char2int($ARGLIST, $_) if $pt == $INT;
25        $ch = int2char($ARGLIST, $_) if $pt == $CHAR;
26
27        my $cht = $ch-&gt;{t};
28        unless (array_compatible($cht, $pt)) {
29          type_error(
30            "Type of argument " .($_+1)." in call to " .$f-&gt;value." differs from expected",
31            $f-&gt;line
32          )
33        }
34      }
35
36      # Now attribute "t" has the type of the node
37      $FUNCTIONCALL-&gt;{t} = $ftype-&gt;child(1);
38      return 1;
39    }
</PRE>

<P>

<H4><A NAME="SECTION0018120040000000000000">
Arrays que Difieren en la Primera Dimensión</A>
</H4>
  

<P>
La función <code>array_compatible</code> sigue la costumbre <code>C</code> de
considerar compatibles arrays que difieren en la primera dimensión.
Véase la conducta de <code>gcc</code> al respecto:
<PRE>
pl@nereida:~/Lbook/code/Simple-Types/script$ cat -n ArrayChecking.c
     1  #include &lt;stdio.h&gt;
     2
     3  void f(int a[3][3]) {
     4    a[1][2] = 5;
     5  }
     6
     7  main() {
     8    int b[2][3];
     9    f(b);
    10    printf("%d\n",b[1][2]);
    11  }
pl@nereida:~/Lbook/code/Simple-Types/script$ gcc ArrayChecking.c
pl@nereida:~/Lbook/code/Simple-Types/script$ a.out
5
</PRE>

<P>
Recordemos el código de la función <code>array_compatible</code>:

<P>
<PRE>
pl@nereida:~/doc/casiano/PLBOOK/PLBOOK/code/Simple-Types/lib/Simple$ sed -ne '96,124p' Trans.trg | cat -n
 1  { # support for arrays
 2
 3    sub compute_dimensionality {
..      .......................................................
14    }
15
16    sub is_array {
..      ....................................
20    }
21
22    sub array_compatible {
23      my ($a1, $a2) = @_;
24
25      return 1 if $a1 == $a2;
26      # int a[10][20] and int b[5][20] are considered compatibles
27      return (is_array($a1) &amp;&amp; is_array($a2) &amp;&amp; ($a1-&gt;child(0) == $a2-&gt;child(0)));
28    }
29  }
</PRE>

<P>

<H4><A NAME="SECTION0018120050000000000000">
Ejemplos</A>
</H4>
  

<P>
<PRE>
pl@nereida:~/Lbook/code/Simple-Types/script$ usetypes.pl prueba07.c 2
 1 int a,b,e[10][20];
 2
 3 g() {}
 4
 5 int f(char c) {
 6 char d;
 7  c = 'X';
 8  g(e[d], 'A'+c);
 9  if (c &gt; 0) {
10    int d;
11    d = a + b;
12  }
13  c = d * 2;
14  return c;
15 }
16
Type Error at line 8: Function 'g' called with 2 args expected 0
</PRE>

<P>
<PRE>
pl@nereida:~/Lbook/code/Simple-Types/script$ usetypes.pl prueba22.c 2
 1 int f(char a[10], int b) {
 2   return a[5];
 3 }
 4
 5 int h(int x) {
 6   return x*2;
 7 }
 8
 9 int g() {
10   char x[5];
11   int y[19][30];
12   f(x,h(y));
13 }
Type Error at line 12: Type of argument 1 in call to h differs from expected
</PRE>

<P>
<BR> <HR>
<!--Table of Child-Links-->
<A NAME="CHILD_LINKS"><STRONG>Subsecciones</STRONG></A>

<UL>
<LI><UL>
<LI><UL>
<LI><A NAME="tex2html6169"
  HREF="node306.html#SECTION0018120010000000000000">Guía de Ruta para la Comprobación de Tipos de las LLamadas</A>
<LI><A NAME="tex2html6170"
  HREF="node306.html#SECTION0018120020000000000000">La forma del Árbol de las LLamadas</A>
<LI><A NAME="tex2html6171"
  HREF="node306.html#SECTION0018120030000000000000">Código de Comprobación de las LLamadas</A>
<LI><A NAME="tex2html6172"
  HREF="node306.html#SECTION0018120040000000000000">Arrays que Difieren en la Primera Dimensión</A>
<LI><A NAME="tex2html6173"
  HREF="node306.html#SECTION0018120050000000000000">Ejemplos</A>
</UL></UL></UL>
<!--End of Table of Child-Links-->
<HR>
<A NAME="tex2html6167"
  HREF="node307.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html6161"
  HREF="node294.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html6155"
  HREF="node305.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html6163"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A> 
<A NAME="tex2html6165"
  HREF="node322.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A> <A NAME="tex2html2"
  HREF="http://nereida.deioc.ull.es/~pl/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="PL.jpg"
 ALT="PL"></A><A NAME="tex2html3"
  HREF="http://campusvirtual.ull.es/0910/course/view.php?id=1148"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="hatpl.png"
 ALT="PL moodle"></A><A NAME="tex2html4"
  HREF="pl.ps"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="gv.jpeg"
 ALT="ps"></A><A NAME="tex2html5"
  HREF="perl_errata_form.html"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="icon_errata.jpg"
 ALT="errata"></A><A NAME="tex2html6"
  HREF="http://search.cpan.org/"><IMG
  WIDTH="60" ALIGN="BOTTOM" BORDER="0"
 SRC="lupa.gif"
 ALT="modulos"></A><A NAME="tex2html7"
  HREF="http://www.perlmonks.org/?node=Seekers of Perl Wisdom"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="monk.gif"
 ALT="perlmonks"></A><A NAME="tex2html8"
  HREF="http://perldoc.perl.org/"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="perlonion.jpeg"
 ALT="perldoc"></A><A NAME="tex2html9"
  HREF="http://nereida.deioc.ull.es/~lhp/perlexamples/"><IMG
  WIDTH="22" ALIGN="BOTTOM" BORDER="0"
 SRC="logoLHP.jpg"
 ALT="apuntes LHP"></A><A NAME="tex2html10"
  HREF="http://www.google.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ggoogle.gif"
 ALT="google"></A><A NAME="tex2html11"
  HREF="http://www.etsii.ull.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="etsii.png"
 ALT="etsii"></A><A NAME="tex2html12"
  HREF="http://www.ull.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ull.gif"
 ALT="ull"></A><A NAME="tex2html13"
  HREF="http://nereida.deioc.ull.es/"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="pcgull"></A>
<BR>
<B> Sig:</B> <A NAME="tex2html6168"
  HREF="node307.html">Comprobación de Tipos: Sentencia</A>
<B>Sup:</B> <A NAME="tex2html6162"
  HREF="node294.html">Análisis de Tipos</A>
<B> Ant:</B> <A NAME="tex2html6156"
  HREF="node305.html">Comprobación de Tipos: Sentencias</A>
 <B>Err:</B> <a href="perl_errata_form.html" target="_blank">Si hallas una errata ...</a>

<!--End of Navigation Panel-->
<ADDRESS>
<I>Casiano Rodríguez León <BR>
2013-03-05</I>
</ADDRESS>
</BODY>
</HTML>
