<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">

<!--Converted with LaTeX2HTML 2008 (1.71)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>Nombres para los Atributos</TITLE>
<META NAME="description" CONTENT="Nombres para los Atributos">
<META NAME="keywords" CONTENT="perlexamples">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META NAME="Generator" CONTENT="LaTeX2HTML v2008">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="mystyle.css">

<LINK REL="next" HREF="node244.html">
<LINK REL="previous" HREF="node242.html">
<LINK REL="up" HREF="node229.html">
<LINK REL="next" HREF="node244.html">
</HEAD>

<BODY >

<A NAME="tex2html5061"
  HREF="node244.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html5055"
  HREF="node229.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html5049"
  HREF="node242.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html5057"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A> 
<A NAME="tex2html5059"
  HREF="node322.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A> <A NAME="tex2html2"
  HREF="http://nereida.deioc.ull.es/~pl/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="PL.jpg"
 ALT="PL"></A><A NAME="tex2html3"
  HREF="http://campusvirtual.ull.es/0910/course/view.php?id=1148"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="hatpl.png"
 ALT="PL moodle"></A><A NAME="tex2html4"
  HREF="pl.ps"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="gv.jpeg"
 ALT="ps"></A><A NAME="tex2html5"
  HREF="perl_errata_form.html"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="icon_errata.jpg"
 ALT="errata"></A><A NAME="tex2html6"
  HREF="http://search.cpan.org/"><IMG
  WIDTH="60" ALIGN="BOTTOM" BORDER="0"
 SRC="lupa.gif"
 ALT="modulos"></A><A NAME="tex2html7"
  HREF="http://www.perlmonks.org/?node=Seekers of Perl Wisdom"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="monk.gif"
 ALT="perlmonks"></A><A NAME="tex2html8"
  HREF="http://perldoc.perl.org/"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="perlonion.jpeg"
 ALT="perldoc"></A><A NAME="tex2html9"
  HREF="http://nereida.deioc.ull.es/~lhp/perlexamples/"><IMG
  WIDTH="22" ALIGN="BOTTOM" BORDER="0"
 SRC="logoLHP.jpg"
 ALT="apuntes LHP"></A><A NAME="tex2html10"
  HREF="http://www.google.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ggoogle.gif"
 ALT="google"></A><A NAME="tex2html11"
  HREF="http://www.etsii.ull.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="etsii.png"
 ALT="etsii"></A><A NAME="tex2html12"
  HREF="http://www.ull.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ull.gif"
 ALT="ull"></A><A NAME="tex2html13"
  HREF="http://nereida.deioc.ull.es/"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="pcgull"></A>
<BR>
<B> Sig:</B> <A NAME="tex2html5062"
  HREF="node244.html">Bypass Automático</A>
<B>Sup:</B> <A NAME="tex2html5056"
  HREF="node229.html">Análisis Sintáctico con Parse::Eyapp</A>
<B> Ant:</B> <A NAME="tex2html5050"
  HREF="node242.html">Podando el Arbol</A>
 <B>Err:</B> <a href="perl_errata_form.html" target="_blank">Si hallas una errata ...</a>
<BR> <P>

<!--End of Navigation Panel-->

<H1><A NAME="SECTION0013140000000000000000"></A>
<A NAME="section:eyappejemplodeuso"></A>
<BR>
Nombres para los Atributos
</H1>

<P>

<H4><A NAME="SECTION0013140010000000000000">
Desventajas de la Notación Posicional</A>
</H4>
  

<P>
Dentro de las acciones los atributos de la parte derecha de la regla de producción
<!-- MATH
 $A \rightarrow X_1 \ldots X_n$
 -->
<IMG
 WIDTH="117" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img469.png"
 ALT="$ A \rightarrow X_1 \ldots X_n$">

se pasan como parámetros en <code>$_[1]</code>, <code>$_[2]</code>, etc.
La notación posicional para los atributos puede ser inconveniente si el número de símbolos es grande.
También puede resultar inconveniente durante la fase de desarrollo: 
Puede ocurrir que hemos escrito la regla  <!-- MATH
 $A \rightarrow X_1 X_2 X_3$
 -->
<IMG
 WIDTH="111" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img507.png"
 ALT="$ A \rightarrow X_1 X_2 X_3$">

y la acción semántica (por ejemplo <code>{ $f = $_[1]*$_[3]+$_[2]; $_[2] }</code>
y - en determinado momento - nos damos cuenta que debemos cambiar la regla añadiendo
un nuevo símbolo <!-- MATH
 $A \rightarrow X_1 Y X_2 X_3$
 -->
<IMG
 WIDTH="125" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img508.png"
 ALT="$ A \rightarrow X_1 Y X_2 X_3$">
 o suprimiendo alguno que ya existía. 
O quizá queremos insertar una
acción en algún lugar intermedio de la regla. O quizá reordenamos los símbolos en
la parte derecha. En todos estos caso nos encontramos en la 
situación de que debemos reenumerar todos los argumentos dentro de la acción
semántica. En el ejemplo anterior tendríamos que reescribir la acción como:

<P>
<PRE>
{ $f = $_[1]*$_[4]+$_[3]; $_[3] }
</PRE>

<P>

<H4><A NAME="SECTION0013140020000000000000">
La notación Dolar</A>
</H4>
  

<P>
Para tratar con esta situación eyapp provee mecanismos para darle nombres a
los atributos semánticos asociados con los símbolos. Uno de esos mecanismos
es prefijar el símbolo con un dolar. Ello indica que el nombre del símbolo
puede ser usado dentro de la acción como nombre del atributo asociado.
Por ejemplo, el código en la línea 22 imprime el atributo asociado
con la variable sintáctica <code>expr</code>, que en este caso es su valor numérico.

<P>

<H4><A NAME="SECTION0013140030000000000000">
La Notación Punto</A>
</H4>
  

<P>
La otra notación usada para darle nombres a los atributos consiste
en concatenar el símbolo en la parte derecha de la regla de un punto seguido
del nombre del atributo
(el código completo figura en el apéndice en la página <A HREF="#apendice:calcyp"><IMG  ALIGN="BOTTOM" BORDER="1" ALT="[*]" SRC="crossref.png"></A>):

<P>
<PRE>
26  exp:
27      NUM
28    | $VAR                    { $s{$VAR} }
29    | VAR.x '=' exp.y         { $s{$x} = $y }
30    | exp.x '+' exp.y         { $x + $y }
31    | exp.x '-' exp.y         { $x - $y }
32    | exp.x '*' exp.y         { $x * $y }
33    | exp.x '^' exp.y         { $x ** $y }
34    | exp.x '/' exp.y
35      {
36        my $parser = shift;
37
38             $y and return($x / $y);
39         $parser-&gt;YYData-&gt;{ERRMSG}
40           =   "Illegal division by zero.\n";
41         $parser-&gt;YYError;
42         undef
43      }
44    |   '-' $exp %prec NEG
45      { -$exp }
46    |   '(' $exp ')'
47      { $exp }
48  ;
</PRE>

<P>

<H4><A NAME="SECTION0013140040000000000000">
La Cabecera y el Arranque</A>
</H4>
  

<P>
El atributo asociado con <code>start</code> (línea 12) es una referencia a
un par. El segundo componente del par es una referencia a la tabla de símbolos.
El primero es una referencia a la lista de valores resultantes de la evaluación 
de las diferentes expresiones.

<P>
<PRE>
pl@nereida:~/LEyapp/examples$ cat -n CalcSimple.eyp
 1  # CalcSimple.eyp
 2  %right  '='
 3  %left   '-' '+'
 4  %left   '*' '/'
 5  %left   NEG
 6  %right  '^'
 7  %{
 8  my %s;
 9  %}
10
11  %%
12  start: input { [ $_[1], \%s] }
13  ;
14
15  input:
16      /* empty */     { [] }
17    | input line  { push(@{$_[1]},$_[2]) if defined($_[2]); $_[1] }
18  ;
</PRE>

<P>
La línea 17 indica que el atributo asociado con la variable
sintáctica <code>input</code> es una referencia
a una pila y que el atributo asociado con la variable sintáctica
<code>line</code> debe empujarse
en la pila. 

<P>
De hecho, el atributo asociado con <code>line</code> es el valor
de la expresión evaluada en esa línea. Asi pues el atributo retornado por <code>input</code> es
una referencia a una lista conteniendo los valores de las expresiones
evaluadas. Observe que expresiones erróneas no aparecerán en la lista.

<P>
<PRE>
20  line:
21    '\n'         { undef }
22    | $exp '\n'  { print "$exp\n"; $exp }
23    | error '\n' { $_[0]-&gt;YYErrok; undef }
24  ;
</PRE>

<P>

<H4><A NAME="SECTION0013140050000000000000">
La Cola</A>
</H4>
  

<P>
Veamos el código del analizador
léxico:

<P>
<PRE>
50  %%
51
52  sub _Error {
..   .............................
62  }
63
64  my $input;
65
66  sub _Lexer {
67    my($parser)=shift;
68
69    # topicalize $input
70    for ($input) {
71      s/^[ \t]//;      # skip whites
72      return('',undef) unless $_;
73      return('NUM',$1) if s{^([0-9]+(?:\.[0-9]+)?)}{};
74      return('VAR',$1) if s/^([A-Za-z][A-Za-z0-9_]*)//;
75      return($1,$1)    if s/^(.)//s;
76    }
77
78    return('',undef);
79  }
80
81  sub Run {
82      my($self)=shift;
83
84      $input = shift;
85      return $self-&gt;YYParse( yylex =&gt; \&amp;_Lexer, yyerror =&gt; \&amp;_Error,
86                             #yydebug =&gt; 0xF
87                           );
88  }
</PRE>

<P>

<H4><A NAME="SECTION0013140060000000000000">
Recuperación de Errores</A>
</H4>
  

<P>
Las entradas pueden contener errores. 
El lenguaje <code>eyapp</code> proporciona un <B>token</B> especial,
<code>error</code>, que puede ser utilizado en el programa fuente
para extender el analizador con producciones de error 
que lo dotan de cierta capacidad para 
recuperase de  una entrada errónea y poder continuar 
analizando el resto de la entrada.

<P>
<PRE>
20  line:
21    '\n'         { undef }
22    | $exp '\n'  { print "$exp\n"; $exp }
23    | error '\n' { $_[0]-&gt;YYErrok; undef }
24  ;
</PRE>

<P>
Cuando se produce un error
en el análisis, <code>eyapp</code> emite un mensaje de error (Algo
como <code>"syntax error"</code>) y
produce ``mágicamente'' el terminal especial denominado
<code>error</code>. A partir de ahí permanecerá silencioso,
consumiendo terminales hasta encontrar una
regla que sea capaz de consumir el terminal <code>error</code>.
La idea general es que, a traves de la regla
de recuperación de errores de la línea 23 se
indica que cuando se produzca un error
el analizador debe descartar todos los <B>tokens</B> hasta llegar a un
retorno de carro. 

<P>
Además, mediante la llamada al método  <code>$_[0]-&gt;YYErrok</code> el programador
anuncia que, si se alcanza este punto, la recuperación puede considerarse ''completa''  y que 
<code>eyapp</code> puede emitir a partir de ese momento mensajes de error
con la seguridad de que no son consecuencia de un comportamiento inestable
provocado por el primer error.

<P>

<H4><A NAME="SECTION0013140070000000000000">
La Acción por Defecto</A>
</H4>
  

<P>
Observemos la regla:

<P>
<PRE>
26  exp:
27      NUM
</PRE>
La acción por defecto es retornar <code>$_[1]</code>. 
Por tanto, en el caso de la regla de la línea 27 
el valor retornado es el asociado a <code>NUM</code>.

<P>

<H4><A NAME="SECTION0013140080000000000000">
Manejo de los símbolos</A>
</H4>
  

<P>
La calculadora usa un hash léxico <code>%s</code> como tabla de símbolos.
Cuando dentro de una expresión encontramos una alusión a una variable
retornamos el valor asociado <code>$s{$_[1]}</code> que ha sido guardado en la correspondiente
entrada de la tabla de símbolos:
<PRE>
 .  ...
 7  %{
 8  my %s;
 9  %}
..  ...
11  %%
..  ...
26  exp:
27      NUM
28    | $VAR                    { $s{$VAR} }
29    | VAR.x '=' exp.y         { $s{$x} = $y }
30    | exp.x '+' exp.y         { $x + $y }
..  ...
</PRE>

<P>

<H4><A NAME="SECTION0013140090000000000000">
El Atributo <TT>YYData</TT></A>
</H4>
  

<P>
En la regla de la división comprobamos que el divisor es 
distinto de cero. 
<PRE>
34    | exp.x '/' exp.y
35      {
36        my $parser = shift;
37
38             $y and return($x / $y);
39         $parser-&gt;YYData-&gt;{ERRMSG}
40           =   "Illegal division by zero.\n";
41         $parser-&gt;YYError;
42         undef
43      }
</PRE>

<P>
El método <code>YYData</code> provee acceso a un hash que se maneja 
como una zona de datos para el programa cliente.
En el ejemplo usamos una entrada <code>ERRMSG</code> para alojar 
el mensaje de error.

<P>
Este mensaje es aprovechado por la subrutina
de tratamiento de errores:

<P>
<PRE>
52  sub _Error {
53    my $private = $_[0]-&gt;YYData;
54
55        exists $private-&gt;{ERRMSG}
56    and do {
57        print $private-&gt;{ERRMSG};
58        delete $private-&gt;{ERRMSG};
59        return;
60    };
61    print "Syntax error.\n";
62  }
</PRE>

<P>
La subrutina <code>_Error</code> es llamada
por el analizador sintáctico 
generado por <code>eyapp</code> cada vez que ocurre un error
sintáctico. Para que ello sea posible
en la llamada 
al analizador se especifican quienes son la rutina de análisis
léxico y quien es la rutina a llamar en caso de error:

<P>
<PRE>
$self-&gt;YYParse( yylex =&gt; \&amp;_Lexer, yyerror =&gt; \&amp;_Error );
</PRE>

<P>

<H4><A NAME="SECTION00131400100000000000000">
El Programa Cliente</A>
</H4>
  

<P>
Veamos los contenidos del ejecutable <code>usecalcsimple.pl</code> el cuál
utiliza el módulo generado por <code>eyapp</code>:
<PRE>
pl@nereida:~/LEyapp/examples$ cat -n usecalcsimple.pl
 1  #!/usr/bin/perl -w
 2  use strict;
 3  use CalcSimple;
 4  use Carp;
 5
 6  sub slurp_file {
 7    my $fn = shift;
 8    my $f;
 9
10    local $/ = undef;
11    if (defined($fn)) {
12      open $f, $fn
13    }
14    else {
15      $f = \*STDIN;
16    }
17    my $input = &lt;$f&gt;;
18    return $input;
19  }
20
21  my $parser = CalcSimple-&gt;new();
22
23  my $input = slurp_file( shift() );
24  my ($r, $s) = @{$parser-&gt;Run($input)};
25
26  print "========= Results  ==============\n";
27  print "$_\n" for @$r;
28  print "========= Symbol Table ==============\n";
29  print "$_ = $s-&gt;{$_}\n" for sort keys %$s;
</PRE>

<P>

<H4><A NAME="SECTION00131400110000000000000">
Ejecución</A>
</H4>
  

<P>
Veamos una ejecución:

<P>
<PRE>
pl@nereida:~/LEyapp/examples$ cat prueba.exp
a=2*3
b=a+1
pl@nereida:~/LEyapp/examples$ usecalcsimple.pl prueba.exp
6
7
========= Results  ==============
6
7
========= Symbol Table ==============
a = 6
b = 7
</PRE>
La primera aparición de la cadena 
<code>"6\n7"</code> es debida a la acción <code>print</code> en el cuerpo 
de la gramática. La segunda es el resultado de la línea 27 en el programa cliente.

<P>
<BR> <HR>
<!--Table of Child-Links-->
<A NAME="CHILD_LINKS"><STRONG>Subsecciones</STRONG></A>

<UL>
<LI><UL>
<LI><UL>
<LI><A NAME="tex2html5063"
  HREF="node243.html#SECTION0013140010000000000000">Desventajas de la Notación Posicional</A>
<LI><A NAME="tex2html5064"
  HREF="node243.html#SECTION0013140020000000000000">La notación Dolar</A>
<LI><A NAME="tex2html5065"
  HREF="node243.html#SECTION0013140030000000000000">La Notación Punto</A>
<LI><A NAME="tex2html5066"
  HREF="node243.html#SECTION0013140040000000000000">La Cabecera y el Arranque</A>
<LI><A NAME="tex2html5067"
  HREF="node243.html#SECTION0013140050000000000000">La Cola</A>
<LI><A NAME="tex2html5068"
  HREF="node243.html#SECTION0013140060000000000000">Recuperación de Errores</A>
<LI><A NAME="tex2html5069"
  HREF="node243.html#SECTION0013140070000000000000">La Acción por Defecto</A>
<LI><A NAME="tex2html5070"
  HREF="node243.html#SECTION0013140080000000000000">Manejo de los símbolos</A>
<LI><A NAME="tex2html5071"
  HREF="node243.html#SECTION0013140090000000000000">El Atributo <TT>YYData</TT></A>
<LI><A NAME="tex2html5072"
  HREF="node243.html#SECTION00131400100000000000000">El Programa Cliente</A>
<LI><A NAME="tex2html5073"
  HREF="node243.html#SECTION00131400110000000000000">Ejecución</A>
</UL></UL></UL>
<!--End of Table of Child-Links-->
<HR>
<A NAME="tex2html5061"
  HREF="node244.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html5055"
  HREF="node229.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html5049"
  HREF="node242.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html5057"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A> 
<A NAME="tex2html5059"
  HREF="node322.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A> <A NAME="tex2html2"
  HREF="http://nereida.deioc.ull.es/~pl/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="PL.jpg"
 ALT="PL"></A><A NAME="tex2html3"
  HREF="http://campusvirtual.ull.es/0910/course/view.php?id=1148"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="hatpl.png"
 ALT="PL moodle"></A><A NAME="tex2html4"
  HREF="pl.ps"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="gv.jpeg"
 ALT="ps"></A><A NAME="tex2html5"
  HREF="perl_errata_form.html"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="icon_errata.jpg"
 ALT="errata"></A><A NAME="tex2html6"
  HREF="http://search.cpan.org/"><IMG
  WIDTH="60" ALIGN="BOTTOM" BORDER="0"
 SRC="lupa.gif"
 ALT="modulos"></A><A NAME="tex2html7"
  HREF="http://www.perlmonks.org/?node=Seekers of Perl Wisdom"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="monk.gif"
 ALT="perlmonks"></A><A NAME="tex2html8"
  HREF="http://perldoc.perl.org/"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="perlonion.jpeg"
 ALT="perldoc"></A><A NAME="tex2html9"
  HREF="http://nereida.deioc.ull.es/~lhp/perlexamples/"><IMG
  WIDTH="22" ALIGN="BOTTOM" BORDER="0"
 SRC="logoLHP.jpg"
 ALT="apuntes LHP"></A><A NAME="tex2html10"
  HREF="http://www.google.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ggoogle.gif"
 ALT="google"></A><A NAME="tex2html11"
  HREF="http://www.etsii.ull.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="etsii.png"
 ALT="etsii"></A><A NAME="tex2html12"
  HREF="http://www.ull.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ull.gif"
 ALT="ull"></A><A NAME="tex2html13"
  HREF="http://nereida.deioc.ull.es/"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="pcgull"></A>
<BR>
<B> Sig:</B> <A NAME="tex2html5062"
  HREF="node244.html">Bypass Automático</A>
<B>Sup:</B> <A NAME="tex2html5056"
  HREF="node229.html">Análisis Sintáctico con Parse::Eyapp</A>
<B> Ant:</B> <A NAME="tex2html5050"
  HREF="node242.html">Podando el Arbol</A>
 <B>Err:</B> <a href="perl_errata_form.html" target="_blank">Si hallas una errata ...</a>

<!--End of Navigation Panel-->
<ADDRESS>
<I>Casiano Rodríguez León <BR>
2013-03-05</I>
</ADDRESS>
</BODY>
</HTML>
